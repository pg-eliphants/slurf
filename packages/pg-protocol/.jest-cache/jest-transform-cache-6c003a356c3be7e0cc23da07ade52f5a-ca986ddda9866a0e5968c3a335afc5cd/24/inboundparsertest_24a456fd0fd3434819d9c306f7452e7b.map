{"file":"C:\\repos\\node-postgres\\packages\\pg-protocol\\src\\inbound-parser.test.ts","mappings":"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","names":[],"sources":["C:\\repos\\node-postgres\\packages\\pg-protocol\\src\\inbound-parser.test.ts"],"sourcesContent":["import buffers from './testing/test-buffers';\r\nimport BufferList from './testing/buffer-list';\r\nimport { parse } from '.';\r\n\r\nimport { PassThrough } from 'stream';\r\nimport { BackendMessage } from './messages';\r\n\r\nvar authOkBuffer = buffers.authenticationOk();\r\nvar paramStatusBuffer = buffers.parameterStatus('client_encoding', 'UTF8');\r\nvar readyForQueryBuffer = buffers.readyForQuery();\r\nvar backendKeyDataBuffer = buffers.backendKeyData(1, 2);\r\nvar commandCompleteBuffer = buffers.commandComplete('SELECT 3');\r\nvar parseCompleteBuffer = buffers.parseComplete();\r\nvar bindCompleteBuffer = buffers.bindComplete();\r\nvar portalSuspendedBuffer = buffers.portalSuspended();\r\n\r\n/*var addRow = function (bufferList: BufferList, name: string, offset: number) {\r\n    return bufferList\r\n        .addCString(name) // field name\r\n        .addInt32(offset++) // table id\r\n        .addInt16(offset++) // attribute of column number\r\n        .addInt32(offset++) // objectId of field's data type\r\n        .addInt16(offset++) // datatype size\r\n        .addInt32(offset++) // type modifier\r\n        .addInt16(0); // format code, 0 => text\r\n};\r\n*/\r\nvar row1 = {\r\n    name: 'id',\r\n    tableID: 1,\r\n    attributeNumber: 2,\r\n    dataTypeID: 3,\r\n    dataTypeSize: 4,\r\n    typeModifier: 5,\r\n    formatCode: 0\r\n};\r\nvar oneRowDescBuff = buffers.rowDescription([row1]);\r\nrow1.name = 'bang';\r\n\r\nvar twoRowBuf = buffers.rowDescription([\r\n    row1,\r\n    {\r\n        name: 'whoah',\r\n        tableID: 10,\r\n        attributeNumber: 11,\r\n        dataTypeID: 12,\r\n        dataTypeSize: 13,\r\n        typeModifier: 14,\r\n        formatCode: 0\r\n    }\r\n]);\r\n\r\nvar emptyRowFieldBuf = new BufferList().addInt16(0).join(true, 'D');\r\n\r\nvar emptyRowFieldBuf = buffers.dataRow([]);\r\n\r\nvar oneFieldBuf = new BufferList()\r\n    .addInt16(1) // number of fields\r\n    .addInt32(5) // length of bytes of fields\r\n    .addCString('test')\r\n    .join(true, 'D');\r\n\r\nvar oneFieldBuf = buffers.dataRow(['test']);\r\n\r\nvar expectedAuthenticationOkayMessage = {\r\n    name: 'authenticationOk',\r\n    length: 8\r\n};\r\n\r\nvar expectedParameterStatusMessage = {\r\n    name: 'parameterStatus',\r\n    parameterName: 'client_encoding',\r\n    parameterValue: 'UTF8',\r\n    length: 25\r\n};\r\n\r\nvar expectedBackendKeyDataMessage = {\r\n    name: 'backendKeyData',\r\n    processID: 1,\r\n    secretKey: 2\r\n};\r\n\r\nvar expectedReadyForQueryMessage = {\r\n    name: 'readyForQuery',\r\n    length: 5,\r\n    status: 'I'\r\n};\r\n\r\nvar expectedCommandCompleteMessage = {\r\n    name: 'commandComplete',\r\n    length: 13,\r\n    text: 'SELECT 3'\r\n};\r\nvar emptyRowDescriptionBuffer = new BufferList()\r\n    .addInt16(0) // number of fields\r\n    .join(true, 'T');\r\n\r\nvar expectedEmptyRowDescriptionMessage = {\r\n    name: 'rowDescription',\r\n    length: 6,\r\n    fieldCount: 0,\r\n    fields: []\r\n};\r\nvar expectedOneRowMessage = {\r\n    name: 'rowDescription',\r\n    length: 27,\r\n    fieldCount: 1,\r\n    fields: [\r\n        {\r\n            name: 'id',\r\n            tableID: 1,\r\n            columnID: 2,\r\n            dataTypeID: 3,\r\n            dataTypeSize: 4,\r\n            dataTypeModifier: 5,\r\n            format: 'text'\r\n        }\r\n    ]\r\n};\r\n\r\nvar expectedTwoRowMessage = {\r\n    name: 'rowDescription',\r\n    length: 53,\r\n    fieldCount: 2,\r\n    fields: [\r\n        {\r\n            name: 'bang',\r\n            tableID: 1,\r\n            columnID: 2,\r\n            dataTypeID: 3,\r\n            dataTypeSize: 4,\r\n            dataTypeModifier: 5,\r\n            format: 'text'\r\n        },\r\n        {\r\n            name: 'whoah',\r\n            tableID: 10,\r\n            columnID: 11,\r\n            dataTypeID: 12,\r\n            dataTypeSize: 13,\r\n            dataTypeModifier: 14,\r\n            format: 'text'\r\n        }\r\n    ]\r\n};\r\n\r\nvar emptyParameterDescriptionBuffer = new BufferList()\r\n    .addInt16(0) // number of parameters\r\n    .join(true, 't');\r\n\r\nvar oneParameterDescBuf = buffers.parameterDescription([1111]);\r\n\r\nvar twoParameterDescBuf = buffers.parameterDescription([2222, 3333]);\r\n\r\nvar expectedEmptyParameterDescriptionMessage = {\r\n    name: 'parameterDescription',\r\n    length: 6,\r\n    parameterCount: 0,\r\n    dataTypeIDs: []\r\n};\r\n\r\nvar expectedOneParameterMessage = {\r\n    name: 'parameterDescription',\r\n    length: 10,\r\n    parameterCount: 1,\r\n    dataTypeIDs: [1111]\r\n};\r\n\r\nvar expectedTwoParameterMessage = {\r\n    name: 'parameterDescription',\r\n    length: 14,\r\n    parameterCount: 2,\r\n    dataTypeIDs: [2222, 3333]\r\n};\r\n\r\nvar testForMessage = function (buffer: Buffer, expectedMessage: any) {\r\n    it('recieves and parses ' + expectedMessage.name, async () => {\r\n        const messages = await parseBuffers([buffer]);\r\n        const [lastMessage] = messages;\r\n\r\n        for (const key in expectedMessage) {\r\n            expect((lastMessage as any)[key]).toEqual(expectedMessage[key]);\r\n        }\r\n    });\r\n};\r\n\r\nvar plainPasswordBuffer = buffers.authenticationCleartextPassword();\r\nvar md5PasswordBuffer = buffers.authenticationMD5Password();\r\nvar SASLBuffer = buffers.authenticationSASL();\r\nvar SASLContinueBuffer = buffers.authenticationSASLContinue();\r\nvar SASLFinalBuffer = buffers.authenticationSASLFinal();\r\n\r\nvar expectedPlainPasswordMessage = {\r\n    name: 'authenticationCleartextPassword'\r\n};\r\n\r\nvar expectedMD5PasswordMessage = {\r\n    name: 'authenticationMD5Password',\r\n    salt: Buffer.from([1, 2, 3, 4])\r\n};\r\n\r\nvar expectedSASLMessage = {\r\n    name: 'authenticationSASL',\r\n    mechanisms: ['SCRAM-SHA-256']\r\n};\r\n\r\nvar expectedSASLContinueMessage = {\r\n    name: 'authenticationSASLContinue',\r\n    data: 'data'\r\n};\r\n\r\nvar expectedSASLFinalMessage = {\r\n    name: 'authenticationSASLFinal',\r\n    data: 'data'\r\n};\r\n\r\nvar notificationResponseBuffer = buffers.notification(4, 'hi', 'boom');\r\nvar expectedNotificationResponseMessage = {\r\n    name: 'notification',\r\n    processId: 4,\r\n    channel: 'hi',\r\n    payload: 'boom'\r\n};\r\n\r\nconst parseBuffers = async (buffers: Buffer[]): Promise<BackendMessage[]> => {\r\n    const stream = new PassThrough();\r\n    for (const buffer of buffers) {\r\n        stream.write(buffer);\r\n    }\r\n    stream.end();\r\n    const msgs: BackendMessage[] = [];\r\n    await parse(stream, (msg) => msgs.push(msg));\r\n    return msgs;\r\n};\r\n\r\ndescribe('PgPacketStream', function () {\r\n    testForMessage(authOkBuffer, expectedAuthenticationOkayMessage);\r\n    testForMessage(plainPasswordBuffer, expectedPlainPasswordMessage);\r\n    testForMessage(md5PasswordBuffer, expectedMD5PasswordMessage);\r\n    testForMessage(SASLBuffer, expectedSASLMessage);\r\n    testForMessage(SASLContinueBuffer, expectedSASLContinueMessage);\r\n\r\n    // this exercises a found bug in the parser:\r\n    // https://github.com/brianc/node-postgres/pull/2210#issuecomment-627626084\r\n    // and adds a test which is deterministic, rather than relying on network packet chunking\r\n    const extendedSASLContinueBuffer = Buffer.concat([SASLContinueBuffer, Buffer.from([1, 2, 3, 4])]);\r\n    testForMessage(extendedSASLContinueBuffer, expectedSASLContinueMessage);\r\n\r\n    testForMessage(SASLFinalBuffer, expectedSASLFinalMessage);\r\n\r\n    // this exercises a found bug in the parser:\r\n    // https://github.com/brianc/node-postgres/pull/2210#issuecomment-627626084\r\n    // and adds a test which is deterministic, rather than relying on network packet chunking\r\n    const extendedSASLFinalBuffer = Buffer.concat([SASLFinalBuffer, Buffer.from([1, 2, 4, 5])]);\r\n    testForMessage(extendedSASLFinalBuffer, expectedSASLFinalMessage);\r\n\r\n    testForMessage(paramStatusBuffer, expectedParameterStatusMessage);\r\n    testForMessage(backendKeyDataBuffer, expectedBackendKeyDataMessage);\r\n    testForMessage(readyForQueryBuffer, expectedReadyForQueryMessage);\r\n    testForMessage(commandCompleteBuffer, expectedCommandCompleteMessage);\r\n    testForMessage(notificationResponseBuffer, expectedNotificationResponseMessage);\r\n    testForMessage(buffers.emptyQuery(), {\r\n        name: 'emptyQuery',\r\n        length: 4\r\n    });\r\n\r\n    testForMessage(Buffer.from([0x6e, 0, 0, 0, 4]), {\r\n        name: 'noData'\r\n    });\r\n\r\n    describe('rowDescription messages', function () {\r\n        testForMessage(emptyRowDescriptionBuffer, expectedEmptyRowDescriptionMessage);\r\n        testForMessage(oneRowDescBuff, expectedOneRowMessage);\r\n        testForMessage(twoRowBuf, expectedTwoRowMessage);\r\n    });\r\n\r\n    describe('parameterDescription messages', function () {\r\n        testForMessage(emptyParameterDescriptionBuffer, expectedEmptyParameterDescriptionMessage);\r\n        testForMessage(oneParameterDescBuf, expectedOneParameterMessage);\r\n        testForMessage(twoParameterDescBuf, expectedTwoParameterMessage);\r\n    });\r\n\r\n    describe('parsing rows', function () {\r\n        describe('parsing empty row', function () {\r\n            testForMessage(emptyRowFieldBuf, {\r\n                name: 'dataRow',\r\n                fieldCount: 0\r\n            });\r\n        });\r\n\r\n        describe('parsing data row with fields', function () {\r\n            testForMessage(oneFieldBuf, {\r\n                name: 'dataRow',\r\n                fieldCount: 1,\r\n                fields: ['test']\r\n            });\r\n        });\r\n    });\r\n\r\n    describe('notice message', function () {\r\n        // this uses the same logic as error message\r\n        var buff = buffers.notice([{ type: 'C', value: 'code' }]);\r\n        testForMessage(buff, {\r\n            name: 'notice',\r\n            code: 'code'\r\n        });\r\n    });\r\n\r\n    testForMessage(buffers.error([]), {\r\n        name: 'error'\r\n    });\r\n\r\n    describe('with all the fields', function () {\r\n        var buffer = buffers.error([\r\n            {\r\n                type: 'S',\r\n                value: 'ERROR'\r\n            },\r\n            {\r\n                type: 'C',\r\n                value: 'code'\r\n            },\r\n            {\r\n                type: 'M',\r\n                value: 'message'\r\n            },\r\n            {\r\n                type: 'D',\r\n                value: 'details'\r\n            },\r\n            {\r\n                type: 'H',\r\n                value: 'hint'\r\n            },\r\n            {\r\n                type: 'P',\r\n                value: '100'\r\n            },\r\n            {\r\n                type: 'p',\r\n                value: '101'\r\n            },\r\n            {\r\n                type: 'q',\r\n                value: 'query'\r\n            },\r\n            {\r\n                type: 'W',\r\n                value: 'where'\r\n            },\r\n            {\r\n                type: 'F',\r\n                value: 'file'\r\n            },\r\n            {\r\n                type: 'L',\r\n                value: 'line'\r\n            },\r\n            {\r\n                type: 'R',\r\n                value: 'routine'\r\n            },\r\n            {\r\n                type: 'Z', // ignored\r\n                value: 'alsdkf'\r\n            }\r\n        ]);\r\n\r\n        testForMessage(buffer, {\r\n            name: 'error',\r\n            severity: 'ERROR',\r\n            code: 'code',\r\n            message: 'message',\r\n            detail: 'details',\r\n            hint: 'hint',\r\n            position: '100',\r\n            internalPosition: '101',\r\n            internalQuery: 'query',\r\n            where: 'where',\r\n            file: 'file',\r\n            line: 'line',\r\n            routine: 'routine'\r\n        });\r\n    });\r\n\r\n    testForMessage(parseCompleteBuffer, {\r\n        name: 'parseComplete'\r\n    });\r\n\r\n    testForMessage(bindCompleteBuffer, {\r\n        name: 'bindComplete'\r\n    });\r\n\r\n    testForMessage(bindCompleteBuffer, {\r\n        name: 'bindComplete'\r\n    });\r\n\r\n    testForMessage(buffers.closeComplete(), {\r\n        name: 'closeComplete'\r\n    });\r\n\r\n    describe('parses portal suspended message', function () {\r\n        testForMessage(portalSuspendedBuffer, {\r\n            name: 'portalSuspended'\r\n        });\r\n    });\r\n\r\n    describe('parses replication start message', function () {\r\n        testForMessage(Buffer.from([0x57, 0x00, 0x00, 0x00, 0x04]), {\r\n            name: 'replicationStart',\r\n            length: 4\r\n        });\r\n    });\r\n\r\n    describe('copy', () => {\r\n        testForMessage(buffers.copyIn(0), {\r\n            name: 'copyInResponse',\r\n            length: 7,\r\n            binary: false,\r\n            columnTypes: []\r\n        });\r\n\r\n        testForMessage(buffers.copyIn(2), {\r\n            name: 'copyInResponse',\r\n            length: 11,\r\n            binary: false,\r\n            columnTypes: [0, 1]\r\n        });\r\n\r\n        testForMessage(buffers.copyOut(0), {\r\n            name: 'copyOutResponse',\r\n            length: 7,\r\n            binary: false,\r\n            columnTypes: []\r\n        });\r\n\r\n        testForMessage(buffers.copyOut(3), {\r\n            name: 'copyOutResponse',\r\n            length: 13,\r\n            binary: false,\r\n            columnTypes: [0, 1, 2]\r\n        });\r\n\r\n        testForMessage(buffers.copyDone(), {\r\n            name: 'copyDone',\r\n            length: 4\r\n        });\r\n\r\n        testForMessage(buffers.copyData(Buffer.from([5, 6, 7])), {\r\n            name: 'copyData',\r\n            length: 7,\r\n            chunk: Buffer.from([5, 6, 7])\r\n        });\r\n    });\r\n\r\n    // since the data message on a stream can randomly divide the incomming\r\n    // tcp packets anywhere, we need to make sure we can parse every single\r\n    // split on a tcp message\r\n    describe('split buffer, single message parsing', function () {\r\n        var fullBuffer = buffers.dataRow([null, 'bang', 'zug zug', null, '!']);\r\n\r\n        it('parses when full buffer comes in', async function () {\r\n            const messages = await parseBuffers([fullBuffer]);\r\n            const message = messages[0] as any;\r\n            expect(message.fields.length).toBe(5);\r\n            expect(message.fields[0]).toBeNull();\r\n            expect(message.fields[1]).toBe('bang');\r\n            expect(message.fields[2]).toBe('zug zug');\r\n            expect(message.fields[3]).toBeNull();\r\n            expect(message.fields[4]).toBe('!');\r\n        });\r\n\r\n        var testMessageRecievedAfterSpiltAt = async function (split: number) {\r\n            var firstBuffer = Buffer.alloc(fullBuffer.length - split);\r\n            var secondBuffer = Buffer.alloc(fullBuffer.length - firstBuffer.length);\r\n            fullBuffer.copy(firstBuffer, 0, 0);\r\n            fullBuffer.copy(secondBuffer, 0, firstBuffer.length);\r\n            const messages = await parseBuffers([fullBuffer]);\r\n            const message = messages[0] as any;\r\n            expect(message.fields.length).toBe(5);\r\n            expect(message.fields[0]).toBe(null);\r\n            expect(message.fields[1]).toBe('bang');\r\n            expect(message.fields[2]).toBe('zug zug');\r\n            expect(message.fields[3]).toBe(null);\r\n            expect(message.fields[4]).toBe('!');\r\n        };\r\n\r\n        it('parses when split in the middle', function () {\r\n            testMessageRecievedAfterSpiltAt(6);\r\n        });\r\n\r\n        it('parses when split at end', function () {\r\n            testMessageRecievedAfterSpiltAt(2);\r\n        });\r\n\r\n        it('parses when split at beginning', function () {\r\n            testMessageRecievedAfterSpiltAt(fullBuffer.length - 2);\r\n            testMessageRecievedAfterSpiltAt(fullBuffer.length - 1);\r\n            testMessageRecievedAfterSpiltAt(fullBuffer.length - 5);\r\n        });\r\n    });\r\n\r\n    describe('split buffer, multiple message parsing', function () {\r\n        var dataRowBuffer = buffers.dataRow(['!']);\r\n        var readyForQueryBuffer = buffers.readyForQuery();\r\n        var fullBuffer = Buffer.alloc(dataRowBuffer.length + readyForQueryBuffer.length);\r\n        dataRowBuffer.copy(fullBuffer, 0, 0);\r\n        readyForQueryBuffer.copy(fullBuffer, dataRowBuffer.length, 0);\r\n\r\n        var verifyMessages = function (messages: any[]) {\r\n            expect(messages.length).toBe(2);\r\n            expect(messages[0]).toEqual({\r\n                name: 'dataRow',\r\n                fieldCount: 1,\r\n                length: 11,\r\n                fields: ['!']\r\n            });\r\n            expect(messages[0].fields[0]).toBe('!');\r\n            expect(messages[1]).toEqual({\r\n                name: 'readyForQuery',\r\n                length: 5,\r\n                status: 'I'\r\n            });\r\n        };\r\n        // sanity check\r\n        it('recieves both messages when packet is not split', async function () {\r\n            const messages = await parseBuffers([fullBuffer]);\r\n            verifyMessages(messages);\r\n        });\r\n\r\n        var splitAndVerifyTwoMessages = async function (split: number) {\r\n            var firstBuffer = Buffer.alloc(fullBuffer.length - split);\r\n            var secondBuffer = Buffer.alloc(fullBuffer.length - firstBuffer.length);\r\n            fullBuffer.copy(firstBuffer, 0, 0);\r\n            fullBuffer.copy(secondBuffer, 0, firstBuffer.length);\r\n            const messages = await parseBuffers([firstBuffer, secondBuffer]);\r\n            verifyMessages(messages);\r\n        };\r\n\r\n        describe('recieves both messages when packet is split', function () {\r\n            it('in the middle', function () {\r\n                return splitAndVerifyTwoMessages(11);\r\n            });\r\n            it('at the front', function () {\r\n                return Promise.all([\r\n                    splitAndVerifyTwoMessages(fullBuffer.length - 1),\r\n                    splitAndVerifyTwoMessages(fullBuffer.length - 4),\r\n                    splitAndVerifyTwoMessages(fullBuffer.length - 6)\r\n                ]);\r\n            });\r\n\r\n            it('at the end', function () {\r\n                return Promise.all([splitAndVerifyTwoMessages(8), splitAndVerifyTwoMessages(1)]);\r\n            });\r\n        });\r\n    });\r\n});\r\n"],"version":3}