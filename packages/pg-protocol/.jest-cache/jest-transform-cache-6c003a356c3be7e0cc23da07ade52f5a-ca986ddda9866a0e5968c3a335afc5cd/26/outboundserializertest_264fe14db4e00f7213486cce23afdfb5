cd4e84889dd0511853bec5244da2b7ae
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const strict_1 = require("node:assert/strict");
const serializer_1 = require("./serializer");
const buffer_list_1 = __importDefault(require("./testing/buffer-list"));
describe('serializer', () => {
    it('builds startup message', function () {
        const actual = serializer_1.serialize.startup({
            user: 'brian',
            database: 'bang'
        });
        strict_1.strict.deepEqual(actual, new buffer_list_1.default()
            .addInt16(3)
            .addInt16(0)
            .addCString('user')
            .addCString('brian')
            .addCString('database')
            .addCString('bang')
            .addCString('client_encoding')
            .addCString('UTF8')
            .addCString('')
            .join(true));
    });
    it('builds password message', function () {
        const actual = serializer_1.serialize.password('!');
        strict_1.strict.deepEqual(actual, new buffer_list_1.default().addCString('!').join(true, 'p'));
    });
    it('builds request ssl message', function () {
        const actual = serializer_1.serialize.requestSsl();
        const expected = new buffer_list_1.default().addInt32(80877103).join(true);
        strict_1.strict.deepEqual(actual, expected);
    });
    it('builds SASLInitialResponseMessage message', function () {
        const actual = serializer_1.serialize.sendSASLInitialResponseMessage('mech', 'data');
        strict_1.strict.deepEqual(actual, new buffer_list_1.default().addCString('mech').addInt32(4).addString('data').join(true, 'p'));
    });
    it('builds SCRAMClientFinalMessage message', function () {
        const actual = serializer_1.serialize.sendSCRAMClientFinalMessage('data');
        strict_1.strict.deepEqual(actual, new buffer_list_1.default().addString('data').join(true, 'p'));
    });
    it('builds query message', function () {
        var txt = 'select * from boom';
        const actual = serializer_1.serialize.query(txt);
        strict_1.strict.deepEqual(actual, new buffer_list_1.default().addCString(txt).join(true, 'Q'));
    });
    describe('parse message', () => {
        it('builds parse message', function () {
            const actual = serializer_1.serialize.parse({ text: '!' });
            var expected = new buffer_list_1.default().addCString('').addCString('!').addInt16(0).join(true, 'P');
            strict_1.strict.deepEqual(actual, expected);
        });
        it('builds parse message with named query', function () {
            const actual = serializer_1.serialize.parse({
                name: 'boom',
                text: 'select * from boom',
                types: []
            });
            var expected = new buffer_list_1.default()
                .addCString('boom')
                .addCString('select * from boom')
                .addInt16(0)
                .join(true, 'P');
            strict_1.strict.deepEqual(actual, expected);
        });
        it('with multiple parameters', function () {
            const actual = serializer_1.serialize.parse({
                name: 'force',
                text: 'select * from bang where name = $1',
                types: [1, 2, 3, 4]
            });
            var expected = new buffer_list_1.default()
                .addCString('force')
                .addCString('select * from bang where name = $1')
                .addInt16(4)
                .addInt32(1)
                .addInt32(2)
                .addInt32(3)
                .addInt32(4)
                .join(true, 'P');
            strict_1.strict.deepEqual(actual, expected);
        });
    });
    describe('bind messages', function () {
        it('with no values', function () {
            const actual = serializer_1.serialize.bind();
            var expectedBuffer = new buffer_list_1.default()
                .addCString('')
                .addCString('')
                .addInt16(0)
                .addInt16(0)
                .addInt16(0)
                .join(true, 'B');
            strict_1.strict.deepEqual(actual, expectedBuffer);
        });
        it('with named statement, portal, and values', function () {
            const actual = serializer_1.serialize.bind({
                portal: 'bang',
                statement: 'woo',
                values: ['1', 'hi', null, 'zing']
            });
            var expectedBuffer = new buffer_list_1.default()
                .addCString('bang') // portal name
                .addCString('woo') // statement name
                .addInt16(4)
                .addInt16(0)
                .addInt16(0)
                .addInt16(0)
                .addInt16(0)
                .addInt16(4)
                .addInt32(1)
                .add(Buffer.from('1'))
                .addInt32(2)
                .add(Buffer.from('hi'))
                .addInt32(-1)
                .addInt32(4)
                .add(Buffer.from('zing'))
                .addInt16(0)
                .join(true, 'B');
            strict_1.strict.deepEqual(actual, expectedBuffer);
        });
    });
    it('with custom valueMapper', function () {
        const actual = serializer_1.serialize.bind({
            portal: 'bang',
            statement: 'woo',
            values: ['1', 'hi', null, 'zing'],
            valueMapper: () => null
        });
        var expectedBuffer = new buffer_list_1.default()
            .addCString('bang') // portal name
            .addCString('woo') // statement name
            .addInt16(4)
            .addInt16(0)
            .addInt16(0)
            .addInt16(0)
            .addInt16(0)
            .addInt16(4)
            .addInt32(-1)
            .addInt32(-1)
            .addInt32(-1)
            .addInt32(-1)
            .addInt16(0)
            .join(true, 'B');
        strict_1.strict.deepEqual(actual, expectedBuffer);
    });
    it('with named statement, portal, and buffer value', function () {
        const actual = serializer_1.serialize.bind({
            portal: 'bang',
            statement: 'woo',
            values: ['1', 'hi', null, Buffer.from('zing', 'utf8')]
        });
        var expectedBuffer = new buffer_list_1.default()
            .addCString('bang') // portal name
            .addCString('woo') // statement name
            .addInt16(4) // value count
            .addInt16(0) // string
            .addInt16(0) // string
            .addInt16(0) // string
            .addInt16(1) // binary
            .addInt16(4)
            .addInt32(1)
            .add(Buffer.from('1'))
            .addInt32(2)
            .add(Buffer.from('hi'))
            .addInt32(-1)
            .addInt32(4)
            .add(Buffer.from('zing', 'utf-8'))
            .addInt16(0)
            .join(true, 'B');
        strict_1.strict.deepEqual(actual, expectedBuffer);
    });
    describe('builds execute message', function () {
        it('for unamed portal with no row limit', function () {
            const actual = serializer_1.serialize.execute();
            var expectedBuffer = new buffer_list_1.default().addCString('').addInt32(0).join(true, 'E');
            strict_1.strict.deepEqual(actual, expectedBuffer);
        });
        it('for named portal with row limit', function () {
            const actual = serializer_1.serialize.execute({
                portal: 'my favorite portal',
                rows: 100
            });
            var expectedBuffer = new buffer_list_1.default().addCString('my favorite portal').addInt32(100).join(true, 'E');
            strict_1.strict.deepEqual(actual, expectedBuffer);
        });
    });
    it('builds flush command', function () {
        const actual = serializer_1.serialize.flush();
        var expected = new buffer_list_1.default().join(true, 'H');
        strict_1.strict.deepEqual(actual, expected);
    });
    it('builds sync command', function () {
        const actual = serializer_1.serialize.sync();
        var expected = new buffer_list_1.default().join(true, 'S');
        strict_1.strict.deepEqual(actual, expected);
    });
    it('builds end command', function () {
        const actual = serializer_1.serialize.end();
        var expected = Buffer.from([0x58, 0, 0, 0, 4]);
        strict_1.strict.deepEqual(actual, expected);
    });
    describe('builds describe command', function () {
        it('describe statement', function () {
            const actual = serializer_1.serialize.describe({ type: 'S', name: 'bang' });
            var expected = new buffer_list_1.default().addChar('S').addCString('bang').join(true, 'D');
            strict_1.strict.deepEqual(actual, expected);
        });
        it('describe unnamed portal', function () {
            const actual = serializer_1.serialize.describe({ type: 'P' });
            var expected = new buffer_list_1.default().addChar('P').addCString('').join(true, 'D');
            strict_1.strict.deepEqual(actual, expected);
        });
    });
    describe('builds close command', function () {
        it('describe statement', function () {
            const actual = serializer_1.serialize.close({ type: 'S', name: 'bang' });
            var expected = new buffer_list_1.default().addChar('S').addCString('bang').join(true, 'C');
            strict_1.strict.deepEqual(actual, expected);
        });
        it('describe unnamed portal', function () {
            const actual = serializer_1.serialize.close({ type: 'P' });
            var expected = new buffer_list_1.default().addChar('P').addCString('').join(true, 'C');
            strict_1.strict.deepEqual(actual, expected);
        });
    });
    describe('copy messages', function () {
        it('builds copyFromChunk', () => {
            const actual = serializer_1.serialize.copyData(Buffer.from([1, 2, 3]));
            const expected = new buffer_list_1.default().add(Buffer.from([1, 2, 3])).join(true, 'd');
            strict_1.strict.deepEqual(actual, expected);
        });
        it('builds copy fail', () => {
            const actual = serializer_1.serialize.copyFail('err!');
            const expected = new buffer_list_1.default().addCString('err!').join(true, 'f');
            strict_1.strict.deepEqual(actual, expected);
        });
        it('builds copy done', () => {
            const actual = serializer_1.serialize.copyDone();
            const expected = new buffer_list_1.default().join(true, 'c');
            strict_1.strict.deepEqual(actual, expected);
        });
    });
    it('builds cancel message', () => {
        const actual = serializer_1.serialize.cancel(3, 4);
        const expected = new buffer_list_1.default().addInt16(1234).addInt16(5678).addInt32(3).addInt32(4).join(true);
        strict_1.strict.deepEqual(actual, expected);
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXHJlcG9zXFxub2RlLXBvc3RncmVzXFxwYWNrYWdlc1xccGctcHJvdG9jb2xcXHNyY1xcb3V0Ym91bmQtc2VyaWFsaXplci50ZXN0LnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsK0NBQXNEO0FBQ3RELDZDQUF5QztBQUN6Qyx3RUFBK0M7QUFFL0MsUUFBUSxDQUFDLFlBQVksRUFBRSxHQUFHLEVBQUU7SUFDeEIsRUFBRSxDQUFDLHdCQUF3QixFQUFFO1FBQ3pCLE1BQU0sTUFBTSxHQUFHLHNCQUFTLENBQUMsT0FBTyxDQUFDO1lBQzdCLElBQUksRUFBRSxPQUFPO1lBQ2IsUUFBUSxFQUFFLE1BQU07U0FDbkIsQ0FBQyxDQUFDO1FBQ0gsZUFBTSxDQUFDLFNBQVMsQ0FDWixNQUFNLEVBQ04sSUFBSSxxQkFBVSxFQUFFO2FBQ1gsUUFBUSxDQUFDLENBQUMsQ0FBQzthQUNYLFFBQVEsQ0FBQyxDQUFDLENBQUM7YUFDWCxVQUFVLENBQUMsTUFBTSxDQUFDO2FBQ2xCLFVBQVUsQ0FBQyxPQUFPLENBQUM7YUFDbkIsVUFBVSxDQUFDLFVBQVUsQ0FBQzthQUN0QixVQUFVLENBQUMsTUFBTSxDQUFDO2FBQ2xCLFVBQVUsQ0FBQyxpQkFBaUIsQ0FBQzthQUM3QixVQUFVLENBQUMsTUFBTSxDQUFDO2FBQ2xCLFVBQVUsQ0FBQyxFQUFFLENBQUM7YUFDZCxJQUFJLENBQUMsSUFBSSxDQUFDLENBQ2xCLENBQUM7SUFDTixDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyx5QkFBeUIsRUFBRTtRQUMxQixNQUFNLE1BQU0sR0FBRyxzQkFBUyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN2QyxlQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxJQUFJLHFCQUFVLEVBQUUsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQy9FLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLDRCQUE0QixFQUFFO1FBQzdCLE1BQU0sTUFBTSxHQUFHLHNCQUFTLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDdEMsTUFBTSxRQUFRLEdBQUcsSUFBSSxxQkFBVSxFQUFFLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNoRSxlQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztJQUN2QyxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQywyQ0FBMkMsRUFBRTtRQUM1QyxNQUFNLE1BQU0sR0FBRyxzQkFBUyxDQUFDLDhCQUE4QixDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQztRQUN4RSxlQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxJQUFJLHFCQUFVLEVBQUUsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDaEgsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsd0NBQXdDLEVBQUU7UUFDekMsTUFBTSxNQUFNLEdBQUcsc0JBQVMsQ0FBQywyQkFBMkIsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUM3RCxlQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxJQUFJLHFCQUFVLEVBQUUsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ2pGLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLHNCQUFzQixFQUFFO1FBQ3ZCLElBQUksR0FBRyxHQUFHLG9CQUFvQixDQUFDO1FBQy9CLE1BQU0sTUFBTSxHQUFHLHNCQUFTLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3BDLGVBQU0sQ0FBQyxTQUFTLENBQUMsTUFBTSxFQUFFLElBQUkscUJBQVUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDL0UsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsZUFBZSxFQUFFLEdBQUcsRUFBRTtRQUMzQixFQUFFLENBQUMsc0JBQXNCLEVBQUU7WUFDdkIsTUFBTSxNQUFNLEdBQUcsc0JBQVMsQ0FBQyxLQUFLLENBQUMsRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztZQUM5QyxJQUFJLFFBQVEsR0FBRyxJQUFJLHFCQUFVLEVBQUUsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQzNGLGVBQU0sQ0FBQyxTQUFTLENBQUMsTUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQ3ZDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHVDQUF1QyxFQUFFO1lBQ3hDLE1BQU0sTUFBTSxHQUFHLHNCQUFTLENBQUMsS0FBSyxDQUFDO2dCQUMzQixJQUFJLEVBQUUsTUFBTTtnQkFDWixJQUFJLEVBQUUsb0JBQW9CO2dCQUMxQixLQUFLLEVBQUUsRUFBRTthQUNaLENBQUMsQ0FBQztZQUNILElBQUksUUFBUSxHQUFHLElBQUkscUJBQVUsRUFBRTtpQkFDMUIsVUFBVSxDQUFDLE1BQU0sQ0FBQztpQkFDbEIsVUFBVSxDQUFDLG9CQUFvQixDQUFDO2lCQUNoQyxRQUFRLENBQUMsQ0FBQyxDQUFDO2lCQUNYLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFDckIsZUFBTSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDdkMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsMEJBQTBCLEVBQUU7WUFDM0IsTUFBTSxNQUFNLEdBQUcsc0JBQVMsQ0FBQyxLQUFLLENBQUM7Z0JBQzNCLElBQUksRUFBRSxPQUFPO2dCQUNiLElBQUksRUFBRSxvQ0FBb0M7Z0JBQzFDLEtBQUssRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQzthQUN0QixDQUFDLENBQUM7WUFDSCxJQUFJLFFBQVEsR0FBRyxJQUFJLHFCQUFVLEVBQUU7aUJBQzFCLFVBQVUsQ0FBQyxPQUFPLENBQUM7aUJBQ25CLFVBQVUsQ0FBQyxvQ0FBb0MsQ0FBQztpQkFDaEQsUUFBUSxDQUFDLENBQUMsQ0FBQztpQkFDWCxRQUFRLENBQUMsQ0FBQyxDQUFDO2lCQUNYLFFBQVEsQ0FBQyxDQUFDLENBQUM7aUJBQ1gsUUFBUSxDQUFDLENBQUMsQ0FBQztpQkFDWCxRQUFRLENBQUMsQ0FBQyxDQUFDO2lCQUNYLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFDckIsZUFBTSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDdkMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxlQUFlLEVBQUU7UUFDdEIsRUFBRSxDQUFDLGdCQUFnQixFQUFFO1lBQ2pCLE1BQU0sTUFBTSxHQUFHLHNCQUFTLENBQUMsSUFBSSxFQUFFLENBQUM7WUFFaEMsSUFBSSxjQUFjLEdBQUcsSUFBSSxxQkFBVSxFQUFFO2lCQUNoQyxVQUFVLENBQUMsRUFBRSxDQUFDO2lCQUNkLFVBQVUsQ0FBQyxFQUFFLENBQUM7aUJBQ2QsUUFBUSxDQUFDLENBQUMsQ0FBQztpQkFDWCxRQUFRLENBQUMsQ0FBQyxDQUFDO2lCQUNYLFFBQVEsQ0FBQyxDQUFDLENBQUM7aUJBQ1gsSUFBSSxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztZQUNyQixlQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxjQUFjLENBQUMsQ0FBQztRQUM3QyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywwQ0FBMEMsRUFBRTtZQUMzQyxNQUFNLE1BQU0sR0FBRyxzQkFBUyxDQUFDLElBQUksQ0FBQztnQkFDMUIsTUFBTSxFQUFFLE1BQU07Z0JBQ2QsU0FBUyxFQUFFLEtBQUs7Z0JBQ2hCLE1BQU0sRUFBRSxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLE1BQU0sQ0FBQzthQUNwQyxDQUFDLENBQUM7WUFDSCxJQUFJLGNBQWMsR0FBRyxJQUFJLHFCQUFVLEVBQUU7aUJBQ2hDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxjQUFjO2lCQUNqQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsaUJBQWlCO2lCQUNuQyxRQUFRLENBQUMsQ0FBQyxDQUFDO2lCQUNYLFFBQVEsQ0FBQyxDQUFDLENBQUM7aUJBQ1gsUUFBUSxDQUFDLENBQUMsQ0FBQztpQkFDWCxRQUFRLENBQUMsQ0FBQyxDQUFDO2lCQUNYLFFBQVEsQ0FBQyxDQUFDLENBQUM7aUJBQ1gsUUFBUSxDQUFDLENBQUMsQ0FBQztpQkFDWCxRQUFRLENBQUMsQ0FBQyxDQUFDO2lCQUNYLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2lCQUNyQixRQUFRLENBQUMsQ0FBQyxDQUFDO2lCQUNYLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2lCQUN0QixRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7aUJBQ1osUUFBUSxDQUFDLENBQUMsQ0FBQztpQkFDWCxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztpQkFDeEIsUUFBUSxDQUFDLENBQUMsQ0FBQztpQkFDWCxJQUFJLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQ3JCLGVBQU0sQ0FBQyxTQUFTLENBQUMsTUFBTSxFQUFFLGNBQWMsQ0FBQyxDQUFDO1FBQzdDLENBQUMsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMseUJBQXlCLEVBQUU7UUFDMUIsTUFBTSxNQUFNLEdBQUcsc0JBQVMsQ0FBQyxJQUFJLENBQUM7WUFDMUIsTUFBTSxFQUFFLE1BQU07WUFDZCxTQUFTLEVBQUUsS0FBSztZQUNoQixNQUFNLEVBQUUsQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxNQUFNLENBQUM7WUFDakMsV0FBVyxFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUk7U0FDMUIsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxjQUFjLEdBQUcsSUFBSSxxQkFBVSxFQUFFO2FBQ2hDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxjQUFjO2FBQ2pDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxpQkFBaUI7YUFDbkMsUUFBUSxDQUFDLENBQUMsQ0FBQzthQUNYLFFBQVEsQ0FBQyxDQUFDLENBQUM7YUFDWCxRQUFRLENBQUMsQ0FBQyxDQUFDO2FBQ1gsUUFBUSxDQUFDLENBQUMsQ0FBQzthQUNYLFFBQVEsQ0FBQyxDQUFDLENBQUM7YUFDWCxRQUFRLENBQUMsQ0FBQyxDQUFDO2FBQ1gsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQ1osUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQ1osUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQ1osUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQ1osUUFBUSxDQUFDLENBQUMsQ0FBQzthQUNYLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDckIsZUFBTSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsY0FBYyxDQUFDLENBQUM7SUFDN0MsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsZ0RBQWdELEVBQUU7UUFDakQsTUFBTSxNQUFNLEdBQUcsc0JBQVMsQ0FBQyxJQUFJLENBQUM7WUFDMUIsTUFBTSxFQUFFLE1BQU07WUFDZCxTQUFTLEVBQUUsS0FBSztZQUNoQixNQUFNLEVBQUUsQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQztTQUN6RCxDQUFDLENBQUM7UUFDSCxJQUFJLGNBQWMsR0FBRyxJQUFJLHFCQUFVLEVBQUU7YUFDaEMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLGNBQWM7YUFDakMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLGlCQUFpQjthQUNuQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsY0FBYzthQUMxQixRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUzthQUNyQixRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUzthQUNyQixRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUzthQUNyQixRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUzthQUNyQixRQUFRLENBQUMsQ0FBQyxDQUFDO2FBQ1gsUUFBUSxDQUFDLENBQUMsQ0FBQzthQUNYLEdBQUcsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2FBQ3JCLFFBQVEsQ0FBQyxDQUFDLENBQUM7YUFDWCxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUN0QixRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDWixRQUFRLENBQUMsQ0FBQyxDQUFDO2FBQ1gsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDO2FBQ2pDLFFBQVEsQ0FBQyxDQUFDLENBQUM7YUFDWCxJQUFJLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ3JCLGVBQU0sQ0FBQyxTQUFTLENBQUMsTUFBTSxFQUFFLGNBQWMsQ0FBQyxDQUFDO0lBQzdDLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLHdCQUF3QixFQUFFO1FBQy9CLEVBQUUsQ0FBQyxxQ0FBcUMsRUFBRTtZQUN0QyxNQUFNLE1BQU0sR0FBRyxzQkFBUyxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ25DLElBQUksY0FBYyxHQUFHLElBQUkscUJBQVUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztZQUNqRixlQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxjQUFjLENBQUMsQ0FBQztRQUM3QyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxpQ0FBaUMsRUFBRTtZQUNsQyxNQUFNLE1BQU0sR0FBRyxzQkFBUyxDQUFDLE9BQU8sQ0FBQztnQkFDN0IsTUFBTSxFQUFFLG9CQUFvQjtnQkFDNUIsSUFBSSxFQUFFLEdBQUc7YUFDWixDQUFDLENBQUM7WUFDSCxJQUFJLGNBQWMsR0FBRyxJQUFJLHFCQUFVLEVBQUUsQ0FBQyxVQUFVLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztZQUNyRyxlQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxjQUFjLENBQUMsQ0FBQztRQUM3QyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLHNCQUFzQixFQUFFO1FBQ3ZCLE1BQU0sTUFBTSxHQUFHLHNCQUFTLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDakMsSUFBSSxRQUFRLEdBQUcsSUFBSSxxQkFBVSxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNoRCxlQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztJQUN2QyxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyxxQkFBcUIsRUFBRTtRQUN0QixNQUFNLE1BQU0sR0FBRyxzQkFBUyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ2hDLElBQUksUUFBUSxHQUFHLElBQUkscUJBQVUsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDaEQsZUFBTSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDdkMsQ0FBQyxDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsb0JBQW9CLEVBQUU7UUFDckIsTUFBTSxNQUFNLEdBQUcsc0JBQVMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUMvQixJQUFJLFFBQVEsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDL0MsZUFBTSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDdkMsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMseUJBQXlCLEVBQUU7UUFDaEMsRUFBRSxDQUFDLG9CQUFvQixFQUFFO1lBQ3JCLE1BQU0sTUFBTSxHQUFHLHNCQUFTLENBQUMsUUFBUSxDQUFDLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztZQUMvRCxJQUFJLFFBQVEsR0FBRyxJQUFJLHFCQUFVLEVBQUUsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFDaEYsZUFBTSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDdkMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMseUJBQXlCLEVBQUU7WUFDMUIsTUFBTSxNQUFNLEdBQUcsc0JBQVMsQ0FBQyxRQUFRLENBQUMsRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztZQUNqRCxJQUFJLFFBQVEsR0FBRyxJQUFJLHFCQUFVLEVBQUUsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFDNUUsZUFBTSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDdkMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxzQkFBc0IsRUFBRTtRQUM3QixFQUFFLENBQUMsb0JBQW9CLEVBQUU7WUFDckIsTUFBTSxNQUFNLEdBQUcsc0JBQVMsQ0FBQyxLQUFLLENBQUMsRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO1lBQzVELElBQUksUUFBUSxHQUFHLElBQUkscUJBQVUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztZQUNoRixlQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztRQUN2QyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyx5QkFBeUIsRUFBRTtZQUMxQixNQUFNLE1BQU0sR0FBRyxzQkFBUyxDQUFDLEtBQUssQ0FBQyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO1lBQzlDLElBQUksUUFBUSxHQUFHLElBQUkscUJBQVUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztZQUM1RSxlQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztRQUN2QyxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGVBQWUsRUFBRTtRQUN0QixFQUFFLENBQUMsc0JBQXNCLEVBQUUsR0FBRyxFQUFFO1lBQzVCLE1BQU0sTUFBTSxHQUFHLHNCQUFTLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMxRCxNQUFNLFFBQVEsR0FBRyxJQUFJLHFCQUFVLEVBQUUsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFDOUUsZUFBTSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDdkMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsa0JBQWtCLEVBQUUsR0FBRyxFQUFFO1lBQ3hCLE1BQU0sTUFBTSxHQUFHLHNCQUFTLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzFDLE1BQU0sUUFBUSxHQUFHLElBQUkscUJBQVUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQ3JFLGVBQU0sQ0FBQyxTQUFTLENBQUMsTUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQ3ZDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGtCQUFrQixFQUFFLEdBQUcsRUFBRTtZQUN4QixNQUFNLE1BQU0sR0FBRyxzQkFBUyxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQ3BDLE1BQU0sUUFBUSxHQUFHLElBQUkscUJBQVUsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFDbEQsZUFBTSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUM7UUFDdkMsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUU7UUFDN0IsTUFBTSxNQUFNLEdBQUcsc0JBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3RDLE1BQU0sUUFBUSxHQUFHLElBQUkscUJBQVUsRUFBRSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbkcsZUFBTSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDdkMsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxccmVwb3NcXG5vZGUtcG9zdGdyZXNcXHBhY2thZ2VzXFxwZy1wcm90b2NvbFxcc3JjXFxvdXRib3VuZC1zZXJpYWxpemVyLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgc3RyaWN0IGFzIGFzc2VydCB9IGZyb20gJ25vZGU6YXNzZXJ0L3N0cmljdCc7XG5pbXBvcnQgeyBzZXJpYWxpemUgfSBmcm9tICcuL3NlcmlhbGl6ZXInO1xuaW1wb3J0IEJ1ZmZlckxpc3QgZnJvbSAnLi90ZXN0aW5nL2J1ZmZlci1saXN0JztcblxuZGVzY3JpYmUoJ3NlcmlhbGl6ZXInLCAoKSA9PiB7XG4gICAgaXQoJ2J1aWxkcyBzdGFydHVwIG1lc3NhZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0IGFjdHVhbCA9IHNlcmlhbGl6ZS5zdGFydHVwKHtcbiAgICAgICAgICAgIHVzZXI6ICdicmlhbicsXG4gICAgICAgICAgICBkYXRhYmFzZTogJ2JhbmcnXG4gICAgICAgIH0pO1xuICAgICAgICBhc3NlcnQuZGVlcEVxdWFsKFxuICAgICAgICAgICAgYWN0dWFsLFxuICAgICAgICAgICAgbmV3IEJ1ZmZlckxpc3QoKVxuICAgICAgICAgICAgICAgIC5hZGRJbnQxNigzKVxuICAgICAgICAgICAgICAgIC5hZGRJbnQxNigwKVxuICAgICAgICAgICAgICAgIC5hZGRDU3RyaW5nKCd1c2VyJylcbiAgICAgICAgICAgICAgICAuYWRkQ1N0cmluZygnYnJpYW4nKVxuICAgICAgICAgICAgICAgIC5hZGRDU3RyaW5nKCdkYXRhYmFzZScpXG4gICAgICAgICAgICAgICAgLmFkZENTdHJpbmcoJ2JhbmcnKVxuICAgICAgICAgICAgICAgIC5hZGRDU3RyaW5nKCdjbGllbnRfZW5jb2RpbmcnKVxuICAgICAgICAgICAgICAgIC5hZGRDU3RyaW5nKCdVVEY4JylcbiAgICAgICAgICAgICAgICAuYWRkQ1N0cmluZygnJylcbiAgICAgICAgICAgICAgICAuam9pbih0cnVlKVxuICAgICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ2J1aWxkcyBwYXNzd29yZCBtZXNzYWdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zdCBhY3R1YWwgPSBzZXJpYWxpemUucGFzc3dvcmQoJyEnKTtcbiAgICAgICAgYXNzZXJ0LmRlZXBFcXVhbChhY3R1YWwsIG5ldyBCdWZmZXJMaXN0KCkuYWRkQ1N0cmluZygnIScpLmpvaW4odHJ1ZSwgJ3AnKSk7XG4gICAgfSk7XG5cbiAgICBpdCgnYnVpbGRzIHJlcXVlc3Qgc3NsIG1lc3NhZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0IGFjdHVhbCA9IHNlcmlhbGl6ZS5yZXF1ZXN0U3NsKCk7XG4gICAgICAgIGNvbnN0IGV4cGVjdGVkID0gbmV3IEJ1ZmZlckxpc3QoKS5hZGRJbnQzMig4MDg3NzEwMykuam9pbih0cnVlKTtcbiAgICAgICAgYXNzZXJ0LmRlZXBFcXVhbChhY3R1YWwsIGV4cGVjdGVkKTtcbiAgICB9KTtcblxuICAgIGl0KCdidWlsZHMgU0FTTEluaXRpYWxSZXNwb25zZU1lc3NhZ2UgbWVzc2FnZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29uc3QgYWN0dWFsID0gc2VyaWFsaXplLnNlbmRTQVNMSW5pdGlhbFJlc3BvbnNlTWVzc2FnZSgnbWVjaCcsICdkYXRhJyk7XG4gICAgICAgIGFzc2VydC5kZWVwRXF1YWwoYWN0dWFsLCBuZXcgQnVmZmVyTGlzdCgpLmFkZENTdHJpbmcoJ21lY2gnKS5hZGRJbnQzMig0KS5hZGRTdHJpbmcoJ2RhdGEnKS5qb2luKHRydWUsICdwJykpO1xuICAgIH0pO1xuXG4gICAgaXQoJ2J1aWxkcyBTQ1JBTUNsaWVudEZpbmFsTWVzc2FnZSBtZXNzYWdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zdCBhY3R1YWwgPSBzZXJpYWxpemUuc2VuZFNDUkFNQ2xpZW50RmluYWxNZXNzYWdlKCdkYXRhJyk7XG4gICAgICAgIGFzc2VydC5kZWVwRXF1YWwoYWN0dWFsLCBuZXcgQnVmZmVyTGlzdCgpLmFkZFN0cmluZygnZGF0YScpLmpvaW4odHJ1ZSwgJ3AnKSk7XG4gICAgfSk7XG5cbiAgICBpdCgnYnVpbGRzIHF1ZXJ5IG1lc3NhZ2UnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0eHQgPSAnc2VsZWN0ICogZnJvbSBib29tJztcbiAgICAgICAgY29uc3QgYWN0dWFsID0gc2VyaWFsaXplLnF1ZXJ5KHR4dCk7XG4gICAgICAgIGFzc2VydC5kZWVwRXF1YWwoYWN0dWFsLCBuZXcgQnVmZmVyTGlzdCgpLmFkZENTdHJpbmcodHh0KS5qb2luKHRydWUsICdRJykpO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ3BhcnNlIG1lc3NhZ2UnLCAoKSA9PiB7XG4gICAgICAgIGl0KCdidWlsZHMgcGFyc2UgbWVzc2FnZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnN0IGFjdHVhbCA9IHNlcmlhbGl6ZS5wYXJzZSh7IHRleHQ6ICchJyB9KTtcbiAgICAgICAgICAgIHZhciBleHBlY3RlZCA9IG5ldyBCdWZmZXJMaXN0KCkuYWRkQ1N0cmluZygnJykuYWRkQ1N0cmluZygnIScpLmFkZEludDE2KDApLmpvaW4odHJ1ZSwgJ1AnKTtcbiAgICAgICAgICAgIGFzc2VydC5kZWVwRXF1YWwoYWN0dWFsLCBleHBlY3RlZCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdidWlsZHMgcGFyc2UgbWVzc2FnZSB3aXRoIG5hbWVkIHF1ZXJ5JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc3QgYWN0dWFsID0gc2VyaWFsaXplLnBhcnNlKHtcbiAgICAgICAgICAgICAgICBuYW1lOiAnYm9vbScsXG4gICAgICAgICAgICAgICAgdGV4dDogJ3NlbGVjdCAqIGZyb20gYm9vbScsXG4gICAgICAgICAgICAgICAgdHlwZXM6IFtdXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHZhciBleHBlY3RlZCA9IG5ldyBCdWZmZXJMaXN0KClcbiAgICAgICAgICAgICAgICAuYWRkQ1N0cmluZygnYm9vbScpXG4gICAgICAgICAgICAgICAgLmFkZENTdHJpbmcoJ3NlbGVjdCAqIGZyb20gYm9vbScpXG4gICAgICAgICAgICAgICAgLmFkZEludDE2KDApXG4gICAgICAgICAgICAgICAgLmpvaW4odHJ1ZSwgJ1AnKTtcbiAgICAgICAgICAgIGFzc2VydC5kZWVwRXF1YWwoYWN0dWFsLCBleHBlY3RlZCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCd3aXRoIG11bHRpcGxlIHBhcmFtZXRlcnMnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zdCBhY3R1YWwgPSBzZXJpYWxpemUucGFyc2Uoe1xuICAgICAgICAgICAgICAgIG5hbWU6ICdmb3JjZScsXG4gICAgICAgICAgICAgICAgdGV4dDogJ3NlbGVjdCAqIGZyb20gYmFuZyB3aGVyZSBuYW1lID0gJDEnLFxuICAgICAgICAgICAgICAgIHR5cGVzOiBbMSwgMiwgMywgNF1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmFyIGV4cGVjdGVkID0gbmV3IEJ1ZmZlckxpc3QoKVxuICAgICAgICAgICAgICAgIC5hZGRDU3RyaW5nKCdmb3JjZScpXG4gICAgICAgICAgICAgICAgLmFkZENTdHJpbmcoJ3NlbGVjdCAqIGZyb20gYmFuZyB3aGVyZSBuYW1lID0gJDEnKVxuICAgICAgICAgICAgICAgIC5hZGRJbnQxNig0KVxuICAgICAgICAgICAgICAgIC5hZGRJbnQzMigxKVxuICAgICAgICAgICAgICAgIC5hZGRJbnQzMigyKVxuICAgICAgICAgICAgICAgIC5hZGRJbnQzMigzKVxuICAgICAgICAgICAgICAgIC5hZGRJbnQzMig0KVxuICAgICAgICAgICAgICAgIC5qb2luKHRydWUsICdQJyk7XG4gICAgICAgICAgICBhc3NlcnQuZGVlcEVxdWFsKGFjdHVhbCwgZXhwZWN0ZWQpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdiaW5kIG1lc3NhZ2VzJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBpdCgnd2l0aCBubyB2YWx1ZXMnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zdCBhY3R1YWwgPSBzZXJpYWxpemUuYmluZCgpO1xuXG4gICAgICAgICAgICB2YXIgZXhwZWN0ZWRCdWZmZXIgPSBuZXcgQnVmZmVyTGlzdCgpXG4gICAgICAgICAgICAgICAgLmFkZENTdHJpbmcoJycpXG4gICAgICAgICAgICAgICAgLmFkZENTdHJpbmcoJycpXG4gICAgICAgICAgICAgICAgLmFkZEludDE2KDApXG4gICAgICAgICAgICAgICAgLmFkZEludDE2KDApXG4gICAgICAgICAgICAgICAgLmFkZEludDE2KDApXG4gICAgICAgICAgICAgICAgLmpvaW4odHJ1ZSwgJ0InKTtcbiAgICAgICAgICAgIGFzc2VydC5kZWVwRXF1YWwoYWN0dWFsLCBleHBlY3RlZEJ1ZmZlcik7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCd3aXRoIG5hbWVkIHN0YXRlbWVudCwgcG9ydGFsLCBhbmQgdmFsdWVzJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc3QgYWN0dWFsID0gc2VyaWFsaXplLmJpbmQoe1xuICAgICAgICAgICAgICAgIHBvcnRhbDogJ2JhbmcnLFxuICAgICAgICAgICAgICAgIHN0YXRlbWVudDogJ3dvbycsXG4gICAgICAgICAgICAgICAgdmFsdWVzOiBbJzEnLCAnaGknLCBudWxsLCAnemluZyddXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHZhciBleHBlY3RlZEJ1ZmZlciA9IG5ldyBCdWZmZXJMaXN0KClcbiAgICAgICAgICAgICAgICAuYWRkQ1N0cmluZygnYmFuZycpIC8vIHBvcnRhbCBuYW1lXG4gICAgICAgICAgICAgICAgLmFkZENTdHJpbmcoJ3dvbycpIC8vIHN0YXRlbWVudCBuYW1lXG4gICAgICAgICAgICAgICAgLmFkZEludDE2KDQpXG4gICAgICAgICAgICAgICAgLmFkZEludDE2KDApXG4gICAgICAgICAgICAgICAgLmFkZEludDE2KDApXG4gICAgICAgICAgICAgICAgLmFkZEludDE2KDApXG4gICAgICAgICAgICAgICAgLmFkZEludDE2KDApXG4gICAgICAgICAgICAgICAgLmFkZEludDE2KDQpXG4gICAgICAgICAgICAgICAgLmFkZEludDMyKDEpXG4gICAgICAgICAgICAgICAgLmFkZChCdWZmZXIuZnJvbSgnMScpKVxuICAgICAgICAgICAgICAgIC5hZGRJbnQzMigyKVxuICAgICAgICAgICAgICAgIC5hZGQoQnVmZmVyLmZyb20oJ2hpJykpXG4gICAgICAgICAgICAgICAgLmFkZEludDMyKC0xKVxuICAgICAgICAgICAgICAgIC5hZGRJbnQzMig0KVxuICAgICAgICAgICAgICAgIC5hZGQoQnVmZmVyLmZyb20oJ3ppbmcnKSlcbiAgICAgICAgICAgICAgICAuYWRkSW50MTYoMClcbiAgICAgICAgICAgICAgICAuam9pbih0cnVlLCAnQicpO1xuICAgICAgICAgICAgYXNzZXJ0LmRlZXBFcXVhbChhY3R1YWwsIGV4cGVjdGVkQnVmZmVyKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnd2l0aCBjdXN0b20gdmFsdWVNYXBwZXInLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnN0IGFjdHVhbCA9IHNlcmlhbGl6ZS5iaW5kKHtcbiAgICAgICAgICAgIHBvcnRhbDogJ2JhbmcnLFxuICAgICAgICAgICAgc3RhdGVtZW50OiAnd29vJyxcbiAgICAgICAgICAgIHZhbHVlczogWycxJywgJ2hpJywgbnVsbCwgJ3ppbmcnXSxcbiAgICAgICAgICAgIHZhbHVlTWFwcGVyOiAoKSA9PiBudWxsXG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgZXhwZWN0ZWRCdWZmZXIgPSBuZXcgQnVmZmVyTGlzdCgpXG4gICAgICAgICAgICAuYWRkQ1N0cmluZygnYmFuZycpIC8vIHBvcnRhbCBuYW1lXG4gICAgICAgICAgICAuYWRkQ1N0cmluZygnd29vJykgLy8gc3RhdGVtZW50IG5hbWVcbiAgICAgICAgICAgIC5hZGRJbnQxNig0KVxuICAgICAgICAgICAgLmFkZEludDE2KDApXG4gICAgICAgICAgICAuYWRkSW50MTYoMClcbiAgICAgICAgICAgIC5hZGRJbnQxNigwKVxuICAgICAgICAgICAgLmFkZEludDE2KDApXG4gICAgICAgICAgICAuYWRkSW50MTYoNClcbiAgICAgICAgICAgIC5hZGRJbnQzMigtMSlcbiAgICAgICAgICAgIC5hZGRJbnQzMigtMSlcbiAgICAgICAgICAgIC5hZGRJbnQzMigtMSlcbiAgICAgICAgICAgIC5hZGRJbnQzMigtMSlcbiAgICAgICAgICAgIC5hZGRJbnQxNigwKVxuICAgICAgICAgICAgLmpvaW4odHJ1ZSwgJ0InKTtcbiAgICAgICAgYXNzZXJ0LmRlZXBFcXVhbChhY3R1YWwsIGV4cGVjdGVkQnVmZmVyKTtcbiAgICB9KTtcblxuICAgIGl0KCd3aXRoIG5hbWVkIHN0YXRlbWVudCwgcG9ydGFsLCBhbmQgYnVmZmVyIHZhbHVlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zdCBhY3R1YWwgPSBzZXJpYWxpemUuYmluZCh7XG4gICAgICAgICAgICBwb3J0YWw6ICdiYW5nJyxcbiAgICAgICAgICAgIHN0YXRlbWVudDogJ3dvbycsXG4gICAgICAgICAgICB2YWx1ZXM6IFsnMScsICdoaScsIG51bGwsIEJ1ZmZlci5mcm9tKCd6aW5nJywgJ3V0ZjgnKV1cbiAgICAgICAgfSk7XG4gICAgICAgIHZhciBleHBlY3RlZEJ1ZmZlciA9IG5ldyBCdWZmZXJMaXN0KClcbiAgICAgICAgICAgIC5hZGRDU3RyaW5nKCdiYW5nJykgLy8gcG9ydGFsIG5hbWVcbiAgICAgICAgICAgIC5hZGRDU3RyaW5nKCd3b28nKSAvLyBzdGF0ZW1lbnQgbmFtZVxuICAgICAgICAgICAgLmFkZEludDE2KDQpIC8vIHZhbHVlIGNvdW50XG4gICAgICAgICAgICAuYWRkSW50MTYoMCkgLy8gc3RyaW5nXG4gICAgICAgICAgICAuYWRkSW50MTYoMCkgLy8gc3RyaW5nXG4gICAgICAgICAgICAuYWRkSW50MTYoMCkgLy8gc3RyaW5nXG4gICAgICAgICAgICAuYWRkSW50MTYoMSkgLy8gYmluYXJ5XG4gICAgICAgICAgICAuYWRkSW50MTYoNClcbiAgICAgICAgICAgIC5hZGRJbnQzMigxKVxuICAgICAgICAgICAgLmFkZChCdWZmZXIuZnJvbSgnMScpKVxuICAgICAgICAgICAgLmFkZEludDMyKDIpXG4gICAgICAgICAgICAuYWRkKEJ1ZmZlci5mcm9tKCdoaScpKVxuICAgICAgICAgICAgLmFkZEludDMyKC0xKVxuICAgICAgICAgICAgLmFkZEludDMyKDQpXG4gICAgICAgICAgICAuYWRkKEJ1ZmZlci5mcm9tKCd6aW5nJywgJ3V0Zi04JykpXG4gICAgICAgICAgICAuYWRkSW50MTYoMClcbiAgICAgICAgICAgIC5qb2luKHRydWUsICdCJyk7XG4gICAgICAgIGFzc2VydC5kZWVwRXF1YWwoYWN0dWFsLCBleHBlY3RlZEJ1ZmZlcik7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnYnVpbGRzIGV4ZWN1dGUgbWVzc2FnZScsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaXQoJ2ZvciB1bmFtZWQgcG9ydGFsIHdpdGggbm8gcm93IGxpbWl0JywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY29uc3QgYWN0dWFsID0gc2VyaWFsaXplLmV4ZWN1dGUoKTtcbiAgICAgICAgICAgIHZhciBleHBlY3RlZEJ1ZmZlciA9IG5ldyBCdWZmZXJMaXN0KCkuYWRkQ1N0cmluZygnJykuYWRkSW50MzIoMCkuam9pbih0cnVlLCAnRScpO1xuICAgICAgICAgICAgYXNzZXJ0LmRlZXBFcXVhbChhY3R1YWwsIGV4cGVjdGVkQnVmZmVyKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ2ZvciBuYW1lZCBwb3J0YWwgd2l0aCByb3cgbGltaXQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zdCBhY3R1YWwgPSBzZXJpYWxpemUuZXhlY3V0ZSh7XG4gICAgICAgICAgICAgICAgcG9ydGFsOiAnbXkgZmF2b3JpdGUgcG9ydGFsJyxcbiAgICAgICAgICAgICAgICByb3dzOiAxMDBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmFyIGV4cGVjdGVkQnVmZmVyID0gbmV3IEJ1ZmZlckxpc3QoKS5hZGRDU3RyaW5nKCdteSBmYXZvcml0ZSBwb3J0YWwnKS5hZGRJbnQzMigxMDApLmpvaW4odHJ1ZSwgJ0UnKTtcbiAgICAgICAgICAgIGFzc2VydC5kZWVwRXF1YWwoYWN0dWFsLCBleHBlY3RlZEJ1ZmZlcik7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ2J1aWxkcyBmbHVzaCBjb21tYW5kJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zdCBhY3R1YWwgPSBzZXJpYWxpemUuZmx1c2goKTtcbiAgICAgICAgdmFyIGV4cGVjdGVkID0gbmV3IEJ1ZmZlckxpc3QoKS5qb2luKHRydWUsICdIJyk7XG4gICAgICAgIGFzc2VydC5kZWVwRXF1YWwoYWN0dWFsLCBleHBlY3RlZCk7XG4gICAgfSk7XG5cbiAgICBpdCgnYnVpbGRzIHN5bmMgY29tbWFuZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY29uc3QgYWN0dWFsID0gc2VyaWFsaXplLnN5bmMoKTtcbiAgICAgICAgdmFyIGV4cGVjdGVkID0gbmV3IEJ1ZmZlckxpc3QoKS5qb2luKHRydWUsICdTJyk7XG4gICAgICAgIGFzc2VydC5kZWVwRXF1YWwoYWN0dWFsLCBleHBlY3RlZCk7XG4gICAgfSk7XG5cbiAgICBpdCgnYnVpbGRzIGVuZCBjb21tYW5kJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zdCBhY3R1YWwgPSBzZXJpYWxpemUuZW5kKCk7XG4gICAgICAgIHZhciBleHBlY3RlZCA9IEJ1ZmZlci5mcm9tKFsweDU4LCAwLCAwLCAwLCA0XSk7XG4gICAgICAgIGFzc2VydC5kZWVwRXF1YWwoYWN0dWFsLCBleHBlY3RlZCk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgnYnVpbGRzIGRlc2NyaWJlIGNvbW1hbmQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGl0KCdkZXNjcmliZSBzdGF0ZW1lbnQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zdCBhY3R1YWwgPSBzZXJpYWxpemUuZGVzY3JpYmUoeyB0eXBlOiAnUycsIG5hbWU6ICdiYW5nJyB9KTtcbiAgICAgICAgICAgIHZhciBleHBlY3RlZCA9IG5ldyBCdWZmZXJMaXN0KCkuYWRkQ2hhcignUycpLmFkZENTdHJpbmcoJ2JhbmcnKS5qb2luKHRydWUsICdEJyk7XG4gICAgICAgICAgICBhc3NlcnQuZGVlcEVxdWFsKGFjdHVhbCwgZXhwZWN0ZWQpO1xuICAgICAgICB9KTtcblxuICAgICAgICBpdCgnZGVzY3JpYmUgdW5uYW1lZCBwb3J0YWwnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBjb25zdCBhY3R1YWwgPSBzZXJpYWxpemUuZGVzY3JpYmUoeyB0eXBlOiAnUCcgfSk7XG4gICAgICAgICAgICB2YXIgZXhwZWN0ZWQgPSBuZXcgQnVmZmVyTGlzdCgpLmFkZENoYXIoJ1AnKS5hZGRDU3RyaW5nKCcnKS5qb2luKHRydWUsICdEJyk7XG4gICAgICAgICAgICBhc3NlcnQuZGVlcEVxdWFsKGFjdHVhbCwgZXhwZWN0ZWQpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdidWlsZHMgY2xvc2UgY29tbWFuZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaXQoJ2Rlc2NyaWJlIHN0YXRlbWVudCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnN0IGFjdHVhbCA9IHNlcmlhbGl6ZS5jbG9zZSh7IHR5cGU6ICdTJywgbmFtZTogJ2JhbmcnIH0pO1xuICAgICAgICAgICAgdmFyIGV4cGVjdGVkID0gbmV3IEJ1ZmZlckxpc3QoKS5hZGRDaGFyKCdTJykuYWRkQ1N0cmluZygnYmFuZycpLmpvaW4odHJ1ZSwgJ0MnKTtcbiAgICAgICAgICAgIGFzc2VydC5kZWVwRXF1YWwoYWN0dWFsLCBleHBlY3RlZCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGl0KCdkZXNjcmliZSB1bm5hbWVkIHBvcnRhbCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnN0IGFjdHVhbCA9IHNlcmlhbGl6ZS5jbG9zZSh7IHR5cGU6ICdQJyB9KTtcbiAgICAgICAgICAgIHZhciBleHBlY3RlZCA9IG5ldyBCdWZmZXJMaXN0KCkuYWRkQ2hhcignUCcpLmFkZENTdHJpbmcoJycpLmpvaW4odHJ1ZSwgJ0MnKTtcbiAgICAgICAgICAgIGFzc2VydC5kZWVwRXF1YWwoYWN0dWFsLCBleHBlY3RlZCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgZGVzY3JpYmUoJ2NvcHkgbWVzc2FnZXMnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGl0KCdidWlsZHMgY29weUZyb21DaHVuaycsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGFjdHVhbCA9IHNlcmlhbGl6ZS5jb3B5RGF0YShCdWZmZXIuZnJvbShbMSwgMiwgM10pKTtcbiAgICAgICAgICAgIGNvbnN0IGV4cGVjdGVkID0gbmV3IEJ1ZmZlckxpc3QoKS5hZGQoQnVmZmVyLmZyb20oWzEsIDIsIDNdKSkuam9pbih0cnVlLCAnZCcpO1xuICAgICAgICAgICAgYXNzZXJ0LmRlZXBFcXVhbChhY3R1YWwsIGV4cGVjdGVkKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ2J1aWxkcyBjb3B5IGZhaWwnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBhY3R1YWwgPSBzZXJpYWxpemUuY29weUZhaWwoJ2VyciEnKTtcbiAgICAgICAgICAgIGNvbnN0IGV4cGVjdGVkID0gbmV3IEJ1ZmZlckxpc3QoKS5hZGRDU3RyaW5nKCdlcnIhJykuam9pbih0cnVlLCAnZicpO1xuICAgICAgICAgICAgYXNzZXJ0LmRlZXBFcXVhbChhY3R1YWwsIGV4cGVjdGVkKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaXQoJ2J1aWxkcyBjb3B5IGRvbmUnLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBhY3R1YWwgPSBzZXJpYWxpemUuY29weURvbmUoKTtcbiAgICAgICAgICAgIGNvbnN0IGV4cGVjdGVkID0gbmV3IEJ1ZmZlckxpc3QoKS5qb2luKHRydWUsICdjJyk7XG4gICAgICAgICAgICBhc3NlcnQuZGVlcEVxdWFsKGFjdHVhbCwgZXhwZWN0ZWQpO1xuICAgICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdidWlsZHMgY2FuY2VsIG1lc3NhZ2UnLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGFjdHVhbCA9IHNlcmlhbGl6ZS5jYW5jZWwoMywgNCk7XG4gICAgICAgIGNvbnN0IGV4cGVjdGVkID0gbmV3IEJ1ZmZlckxpc3QoKS5hZGRJbnQxNigxMjM0KS5hZGRJbnQxNig1Njc4KS5hZGRJbnQzMigzKS5hZGRJbnQzMig0KS5qb2luKHRydWUpO1xuICAgICAgICBhc3NlcnQuZGVlcEVxdWFsKGFjdHVhbCwgZXhwZWN0ZWQpO1xuICAgIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=