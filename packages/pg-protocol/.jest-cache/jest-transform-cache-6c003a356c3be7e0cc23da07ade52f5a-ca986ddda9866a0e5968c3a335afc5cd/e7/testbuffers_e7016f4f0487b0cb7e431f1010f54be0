a1afb5067dc178d0d9164fd9df094921
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
// https://www.postgresql.org/docs/current/protocol-message-formats.html
const buffer_list_1 = __importDefault(require("./buffer-list"));
const buffers = {
    readyForQuery: function () {
        return new buffer_list_1.default().add(Buffer.from('I')).join(true, 'Z');
    },
    authenticationOk: function () {
        return new buffer_list_1.default().addInt32(0).join(true, 'R');
    },
    authenticationCleartextPassword: function () {
        return new buffer_list_1.default().addInt32(3).join(true, 'R');
    },
    authenticationMD5Password: function () {
        return new buffer_list_1.default()
            .addInt32(5)
            .add(Buffer.from([1, 2, 3, 4]))
            .join(true, 'R');
    },
    authenticationSASL: function () {
        return new buffer_list_1.default().addInt32(10).addCString('SCRAM-SHA-256').addCString('').join(true, 'R');
    },
    authenticationSASLContinue: function () {
        return new buffer_list_1.default().addInt32(11).addString('data').join(true, 'R');
    },
    authenticationSASLFinal: function () {
        return new buffer_list_1.default().addInt32(12).addString('data').join(true, 'R');
    },
    parameterStatus: function (name, value) {
        return new buffer_list_1.default().addCString(name).addCString(value).join(true, 'S');
    },
    backendKeyData: function (processID, secretKey) {
        return new buffer_list_1.default().addInt32(processID).addInt32(secretKey).join(true, 'K');
    },
    commandComplete: function (string) {
        return new buffer_list_1.default().addCString(string).join(true, 'C');
    },
    rowDescription: function (fields) {
        fields = fields || [];
        var buf = new buffer_list_1.default();
        buf.addInt16(fields.length);
        fields.forEach(function (field) {
            buf
                .addCString(field.name)
                .addInt32(field.tableID || 0)
                .addInt16(field.attributeNumber || 0)
                .addInt32(field.dataTypeID || 0)
                .addInt16(field.dataTypeSize || 0)
                .addInt32(field.typeModifier || 0)
                .addInt16(field.formatCode || 0);
        });
        return buf.join(true, 'T');
    },
    parameterDescription: function (dataTypeIDs) {
        dataTypeIDs = dataTypeIDs || [];
        var buf = new buffer_list_1.default();
        buf.addInt16(dataTypeIDs.length);
        dataTypeIDs.forEach(function (dataTypeID) {
            buf.addInt32(dataTypeID);
        });
        return buf.join(true, 't');
    },
    dataRow: function (columns) {
        columns = columns || [];
        var buf = new buffer_list_1.default();
        buf.addInt16(columns.length);
        columns.forEach(function (col) {
            if (col == null) {
                buf.addInt32(-1);
            }
            else {
                var strBuf = Buffer.from(col, 'utf8');
                buf.addInt32(strBuf.length);
                buf.add(strBuf);
            }
        });
        return buf.join(true, 'D');
    },
    error: function (fields) {
        return buffers.errorOrNotice(fields).join(true, 'E');
    },
    notice: function (fields) {
        return buffers.errorOrNotice(fields).join(true, 'N');
    },
    errorOrNotice: function (fields) {
        fields = fields || [];
        var buf = new buffer_list_1.default();
        fields.forEach(function (field) {
            buf.addChar(field.type);
            buf.addCString(field.value);
        });
        return buf.add(Buffer.from([0])); // terminator
    },
    parseComplete: function () {
        return new buffer_list_1.default().join(true, '1');
    },
    bindComplete: function () {
        return new buffer_list_1.default().join(true, '2');
    },
    notification: function (id, channel, payload) {
        return new buffer_list_1.default().addInt32(id).addCString(channel).addCString(payload).join(true, 'A');
    },
    emptyQuery: function () {
        return new buffer_list_1.default().join(true, 'I');
    },
    portalSuspended: function () {
        return new buffer_list_1.default().join(true, 's');
    },
    closeComplete: function () {
        return new buffer_list_1.default().join(true, '3');
    },
    copyIn: function (cols) {
        const list = new buffer_list_1.default()
            // text mode
            .addByte(0)
            // column count
            .addInt16(cols);
        for (let i = 0; i < cols; i++) {
            list.addInt16(i);
        }
        return list.join(true, 'G');
    },
    copyOut: function (cols) {
        const list = new buffer_list_1.default()
            // text mode
            .addByte(0)
            // column count
            .addInt16(cols);
        for (let i = 0; i < cols; i++) {
            list.addInt16(i);
        }
        return list.join(true, 'H');
    },
    copyData: function (bytes) {
        return new buffer_list_1.default().add(bytes).join(true, 'd');
    },
    copyDone: function () {
        return new buffer_list_1.default().join(true, 'c');
    },
};
exports.default = buffers;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXHJlcG9zXFxub2RlLXBvc3RncmVzXFxwYWNrYWdlc1xccGctcHJvdG9jb2xcXHNyY1xcdGVzdGluZ1xcdGVzdC1idWZmZXJzLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsd0VBQXdFO0FBQ3hFLGdFQUFzQztBQUV0QyxNQUFNLE9BQU8sR0FBRztJQUNkLGFBQWEsRUFBRTtRQUNiLE9BQU8sSUFBSSxxQkFBVSxFQUFFLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFBO0lBQy9ELENBQUM7SUFFRCxnQkFBZ0IsRUFBRTtRQUNoQixPQUFPLElBQUkscUJBQVUsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFBO0lBQ3JELENBQUM7SUFFRCwrQkFBK0IsRUFBRTtRQUMvQixPQUFPLElBQUkscUJBQVUsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFBO0lBQ3JELENBQUM7SUFFRCx5QkFBeUIsRUFBRTtRQUN6QixPQUFPLElBQUkscUJBQVUsRUFBRTthQUNwQixRQUFRLENBQUMsQ0FBQyxDQUFDO2FBQ1gsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQzlCLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUE7SUFDcEIsQ0FBQztJQUVELGtCQUFrQixFQUFFO1FBQ2xCLE9BQU8sSUFBSSxxQkFBVSxFQUFFLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxlQUFlLENBQUMsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMs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QUMsSUFBSSxDQUFDLENBQUE7UUFDakIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUM3QixJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFBO1NBQ2pCO1FBQ0QsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQTtJQUM3QixDQUFDO0lBRUQsT0FBTyxFQUFFLFVBQVUsSUFBWTtRQUM3QixNQUFNLElBQUksR0FBRyxJQUFJLHFCQUFVLEVBQUU7WUFDM0IsWUFBWTthQUNYLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDWCxlQUFlO2FBQ2QsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFBO1FBQ2pCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDN0IsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQTtTQUNqQjtRQUNELE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUE7SUFDN0IsQ0FBQztJQUVELFFBQVEsRUFBRSxVQUFVLEtBQWE7UUFDL0IsT0FBTyxJQUFJLHFCQUFVLEVBQUUsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQTtJQUNwRCxDQUFDO0lBRUQsUUFBUSxFQUFFO1FBQ1IsT0FBTyxJQUFJLHFCQUFVLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFBO0lBQ3pDLENBQUM7Q0FDRixDQUFBO0FBRUQsa0JBQWUsT0FBTyxDQUFBIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxyZXBvc1xcbm9kZS1wb3N0Z3Jlc1xccGFja2FnZXNcXHBnLXByb3RvY29sXFxzcmNcXHRlc3RpbmdcXHRlc3QtYnVmZmVycy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBodHRwczovL3d3dy5wb3N0Z3Jlc3FsLm9yZy9kb2NzL2N1cnJlbnQvcHJvdG9jb2wtbWVzc2FnZS1mb3JtYXRzLmh0bWxcclxuaW1wb3J0IEJ1ZmZlckxpc3QgZnJvbSAnLi9idWZmZXItbGlzdCdcclxuXHJcbmNvbnN0IGJ1ZmZlcnMgPSB7XHJcbiAgcmVhZHlGb3JRdWVyeTogZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIG5ldyBCdWZmZXJMaXN0KCkuYWRkKEJ1ZmZlci5mcm9tKCdJJykpLmpvaW4odHJ1ZSwgJ1onKVxyXG4gIH0sXHJcblxyXG4gIGF1dGhlbnRpY2F0aW9uT2s6IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiBuZXcgQnVmZmVyTGlzdCgpLmFkZEludDMyKDApLmpvaW4odHJ1ZSwgJ1InKVxyXG4gIH0sXHJcblxyXG4gIGF1dGhlbnRpY2F0aW9uQ2xlYXJ0ZXh0UGFzc3dvcmQ6IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiBuZXcgQnVmZmVyTGlzdCgpLmFkZEludDMyKDMpLmpvaW4odHJ1ZSwgJ1InKVxyXG4gIH0sXHJcblxyXG4gIGF1dGhlbnRpY2F0aW9uTUQ1UGFzc3dvcmQ6IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiBuZXcgQnVmZmVyTGlzdCgpXHJcbiAgICAgIC5hZGRJbnQzMig1KVxyXG4gICAgICAuYWRkKEJ1ZmZlci5mcm9tKFsxLCAyLCAzLCA0XSkpXHJcbiAgICAgIC5qb2luKHRydWUsICdSJylcclxuICB9LFxyXG5cclxuICBhdXRoZW50aWNhdGlvblNBU0w6IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiBuZXcgQnVmZmVyTGlzdCgpLmFkZEludDMyKDEwKS5hZGRDU3RyaW5nKCdTQ1JBTS1TSEEtMjU2JykuYWRkQ1N0cmluZygnJykuam9pbih0cnVlLCAnUicpXHJcbiAgfSxcclxuXHJcbiAgYXV0aGVudGljYXRpb25TQVNMQ29udGludWU6IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiBuZXcgQnVmZmVyTGlzdCgpLmFkZEludDMyKDExKS5hZGRTdHJpbmcoJ2RhdGEnKS5qb2luKHRydWUsICdSJylcclxuICB9LFxyXG5cclxuICBhdXRoZW50aWNhdGlvblNBU0xGaW5hbDogZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIG5ldyBCdWZmZXJMaXN0KCkuYWRkSW50MzIoMTIpLmFkZFN0cmluZygnZGF0YScpLmpvaW4odHJ1ZSwgJ1InKVxyXG4gIH0sXHJcblxyXG4gIHBhcmFtZXRlclN0YXR1czogZnVuY3Rpb24gKG5hbWU6IHN0cmluZywgdmFsdWU6IHN0cmluZykge1xyXG4gICAgcmV0dXJuIG5ldyBCdWZmZXJMaXN0KCkuYWRkQ1N0cmluZyhuYW1lKS5hZGRDU3RyaW5nKHZhbHVlKS5qb2luKHRydWUsICdTJylcclxuICB9LFxyXG5cclxuICBiYWNrZW5kS2V5RGF0YTogZnVuY3Rpb24gKHByb2Nlc3NJRDogbnVtYmVyLCBzZWNyZXRLZXk6IG51bWJlcikge1xyXG4gICAgcmV0dXJuIG5ldyBCdWZmZXJMaXN0KCkuYWRkSW50MzIocHJvY2Vzc0lEKS5hZGRJbnQzMihzZWNyZXRLZXkpLmpvaW4odHJ1ZSwgJ0snKVxyXG4gIH0sXHJcblxyXG4gIGNvbW1hbmRDb21wbGV0ZTogZnVuY3Rpb24gKHN0cmluZzogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4gbmV3IEJ1ZmZlckxpc3QoKS5hZGRDU3RyaW5nKHN0cmluZykuam9pbih0cnVlLCAnQycpXHJcbiAgfSxcclxuXHJcbiAgcm93RGVzY3JpcHRpb246IGZ1bmN0aW9uIChmaWVsZHM6IGFueVtdKSB7XHJcbiAgICBmaWVsZHMgPSBmaWVsZHMgfHwgW11cclxuICAgIHZhciBidWYgPSBuZXcgQnVmZmVyTGlzdCgpXHJcbiAgICBidWYuYWRkSW50MTYoZmllbGRzLmxlbmd0aClcclxuICAgIGZpZWxkcy5mb3JFYWNoKGZ1bmN0aW9uIChmaWVsZCkge1xyXG4gICAgICBidWZcclxuICAgICAgICAuYWRkQ1N0cmluZyhmaWVsZC5uYW1lKVxyXG4gICAgICAgIC5hZGRJbnQzMihmaWVsZC50YWJsZUlEIHx8IDApXHJcbiAgICAgICAgLmFkZEludDE2KGZpZWxkLmF0dHJpYnV0ZU51bWJlciB8fCAwKVxyXG4gICAgICAgIC5hZGRJbnQzMihmaWVsZC5kYXRhVHlwZUlEIHx8IDApXHJcbiAgICAgICAgLmFkZEludDE2KGZpZWxkLmRhdGFUeXBlU2l6ZSB8fCAwKVxyXG4gICAgICAgIC5hZGRJbnQzMihmaWVsZC50eXBlTW9kaWZpZXIgfHwgMClcclxuICAgICAgICAuYWRkSW50MTYoZmllbGQuZm9ybWF0Q29kZSB8fCAwKVxyXG4gICAgfSlcclxuICAgIHJldHVybiBidWYuam9pbih0cnVlLCAnVCcpXHJcbiAgfSxcclxuXHJcbiAgcGFyYW1ldGVyRGVzY3JpcHRpb246IGZ1bmN0aW9uIChkYXRhVHlwZUlEczogbnVtYmVyW10pIHtcclxuICAgIGRhdGFUeXBlSURzID0gZGF0YVR5cGVJRHMgfHwgW11cclxuICAgIHZhciBidWYgPSBuZXcgQnVmZmVyTGlzdCgpXHJcbiAgICBidWYuYWRkSW50MTYoZGF0YVR5cGVJRHMubGVuZ3RoKVxyXG4gICAgZGF0YVR5cGVJRHMuZm9yRWFjaChmdW5jdGlvbiAoZGF0YVR5cGVJRCkge1xyXG4gICAgICBidWYuYWRkSW50MzIoZGF0YVR5cGVJRClcclxuICAgIH0pXHJcbiAgICByZXR1cm4gYnVmLmpvaW4odHJ1ZSwgJ3QnKVxyXG4gIH0sXHJcblxyXG4gIGRhdGFSb3c6IGZ1bmN0aW9uIChjb2x1bW5zOiBhbnlbXSkge1xyXG4gICAgY29sdW1ucyA9IGNvbHVtbnMgfHwgW11cclxuICAgIHZhciBidWYgPSBuZXcgQnVmZmVyTGlzdCgpXHJcbiAgICBidWYuYWRkSW50MTYoY29sdW1ucy5sZW5ndGgpXHJcbiAgICBjb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbCkge1xyXG4gICAgICBpZiAoY29sID09IG51bGwpIHtcclxuICAgICAgICBidWYuYWRkSW50MzIoLTEpXHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdmFyIHN0ckJ1ZiA9IEJ1ZmZlci5mcm9tKGNvbCwgJ3V0ZjgnKVxyXG4gICAgICAgIGJ1Zi5hZGRJbnQzMihzdHJCdWYubGVuZ3RoKVxyXG4gICAgICAgIGJ1Zi5hZGQoc3RyQnVmKVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gICAgcmV0dXJuIGJ1Zi5qb2luKHRydWUsICdEJylcclxuICB9LFxyXG5cclxuICBlcnJvcjogZnVuY3Rpb24gKGZpZWxkczogYW55KSB7XHJcbiAgICByZXR1cm4gYnVmZmVycy5lcnJvck9yTm90aWNlKGZpZWxkcykuam9pbih0cnVlLCAnRScpXHJcbiAgfSxcclxuXHJcbiAgbm90aWNlOiBmdW5jdGlvbiAoZmllbGRzOiBhbnkpIHtcclxuICAgIHJldHVybiBidWZmZXJzLmVycm9yT3JOb3RpY2UoZmllbGRzKS5qb2luKHRydWUsICdOJylcclxuICB9LFxyXG5cclxuICBlcnJvck9yTm90aWNlOiBmdW5jdGlvbiAoZmllbGRzOiBhbnkpIHtcclxuICAgIGZpZWxkcyA9IGZpZWxkcyB8fCBbXVxyXG4gICAgdmFyIGJ1ZiA9IG5ldyBCdWZmZXJMaXN0KClcclxuICAgIGZpZWxkcy5mb3JFYWNoKGZ1bmN0aW9uIChmaWVsZDogYW55KSB7XHJcbiAgICAgIGJ1Zi5hZGRDaGFyKGZpZWxkLnR5cGUpXHJcbiAgICAgIGJ1Zi5hZGRDU3RyaW5nKGZpZWxkLnZhbHVlKVxyXG4gICAgfSlcclxuICAgIHJldHVybiBidWYuYWRkKEJ1ZmZlci5mcm9tKFswXSkpIC8vIHRlcm1pbmF0b3JcclxuICB9LFxyXG5cclxuICBwYXJzZUNvbXBsZXRlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICByZXR1cm4gbmV3IEJ1ZmZlckxpc3QoKS5qb2luKHRydWUsICcxJylcclxuICB9LFxyXG5cclxuICBiaW5kQ29tcGxldGU6IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiBuZXcgQnVmZmVyTGlzdCgpLmpvaW4odHJ1ZSwgJzInKVxyXG4gIH0sXHJcblxyXG4gIG5vdGlmaWNhdGlvbjogZnVuY3Rpb24gKGlkOiBudW1iZXIsIGNoYW5uZWw6IHN0cmluZywgcGF5bG9hZDogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4gbmV3IEJ1ZmZlckxpc3QoKS5hZGRJbnQzMihpZCkuYWRkQ1N0cmluZyhjaGFubmVsKS5hZGRDU3RyaW5nKHBheWxvYWQpLmpvaW4odHJ1ZSwgJ0EnKVxyXG4gIH0sXHJcblxyXG4gIGVtcHR5UXVlcnk6IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiBuZXcgQnVmZmVyTGlzdCgpLmpvaW4odHJ1ZSwgJ0knKVxyXG4gIH0sXHJcblxyXG4gIHBvcnRhbFN1c3BlbmRlZDogZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIG5ldyBCdWZmZXJMaXN0KCkuam9pbih0cnVlLCAncycpXHJcbiAgfSxcclxuXHJcbiAgY2xvc2VDb21wbGV0ZTogZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIG5ldyBCdWZmZXJMaXN0KCkuam9pbih0cnVlLCAnMycpXHJcbiAgfSxcclxuXHJcbiAgY29weUluOiBmdW5jdGlvbiAoY29sczogbnVtYmVyKSB7XHJcbiAgICBjb25zdCBsaXN0ID0gbmV3IEJ1ZmZlckxpc3QoKVxyXG4gICAgICAvLyB0ZXh0IG1vZGVcclxuICAgICAgLmFkZEJ5dGUoMClcclxuICAgICAgLy8gY29sdW1uIGNvdW50XHJcbiAgICAgIC5hZGRJbnQxNihjb2xzKVxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb2xzOyBpKyspIHtcclxuICAgICAgbGlzdC5hZGRJbnQxNihpKVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGxpc3Quam9pbih0cnVlLCAnRycpXHJcbiAgfSxcclxuXHJcbiAgY29weU91dDogZnVuY3Rpb24gKGNvbHM6IG51bWJlcikge1xyXG4gICAgY29uc3QgbGlzdCA9IG5ldyBCdWZmZXJMaXN0KClcclxuICAgICAgLy8gdGV4dCBtb2RlXHJcbiAgICAgIC5hZGRCeXRlKDApXHJcbiAgICAgIC8vIGNvbHVtbiBjb3VudFxyXG4gICAgICAuYWRkSW50MTYoY29scylcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29sczsgaSsrKSB7XHJcbiAgICAgIGxpc3QuYWRkSW50MTYoaSlcclxuICAgIH1cclxuICAgIHJldHVybiBsaXN0LmpvaW4odHJ1ZSwgJ0gnKVxyXG4gIH0sXHJcblxyXG4gIGNvcHlEYXRhOiBmdW5jdGlvbiAoYnl0ZXM6IEJ1ZmZlcikge1xyXG4gICAgcmV0dXJuIG5ldyBCdWZmZXJMaXN0KCkuYWRkKGJ5dGVzKS5qb2luKHRydWUsICdkJylcclxuICB9LFxyXG5cclxuICBjb3B5RG9uZTogZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIG5ldyBCdWZmZXJMaXN0KCkuam9pbih0cnVlLCAnYycpXHJcbiAgfSxcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgYnVmZmVyc1xyXG4iXSwidmVyc2lvbiI6M30=