207f62cd93701393a05068b87eb84c3e
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
// https://www.postgresql.org/docs/current/protocol-message-formats.html
const buffer_list_1 = __importDefault(require("./buffer-list"));
const buffers = {
    readyForQuery: function () {
        return new buffer_list_1.default().add(Buffer.from('I')).join(true, 'Z');
    },
    authenticationOk: function () {
        return new buffer_list_1.default().addInt32(0).join(true, 'R');
    },
    authenticationCleartextPassword: function () {
        return new buffer_list_1.default().addInt32(3).join(true, 'R');
    },
    authenticationMD5Password: function () {
        return new buffer_list_1.default()
            .addInt32(5)
            .add(Buffer.from([1, 2, 3, 4]))
            .join(true, 'R');
    },
    authenticationSASL: function () {
        return new buffer_list_1.default().addInt32(10).addCString('SCRAM-SHA-256').addCString('').join(true, 'R');
    },
    authenticationSASLContinue: function () {
        return new buffer_list_1.default().addInt32(11).addString('data').join(true, 'R');
    },
    authenticationSASLFinal: function () {
        return new buffer_list_1.default().addInt32(12).addString('data').join(true, 'R');
    },
    parameterStatus: function (name, value) {
        return new buffer_list_1.default().addCString(name).addCString(value).join(true, 'S');
    },
    backendKeyData: function (processID, secretKey) {
        return new buffer_list_1.default().addInt32(processID).addInt32(secretKey).join(true, 'K');
    },
    commandComplete: function (string) {
        return new buffer_list_1.default().addCString(string).join(true, 'C');
    },
    rowDescription: function (fields) {
        fields = fields || [];
        var buf = new buffer_list_1.default();
        buf.addInt16(fields.length);
        fields.forEach(function (field) {
            buf.addCString(field.name)
                .addInt32(field.tableID || 0)
                .addInt16(field.attributeNumber || 0)
                .addInt32(field.dataTypeID || 0)
                .addInt16(field.dataTypeSize || 0)
                .addInt32(field.typeModifier || 0)
                .addInt16(field.formatCode || 0);
        });
        return buf.join(true, 'T');
    },
    parameterDescription: function (dataTypeIDs) {
        dataTypeIDs = dataTypeIDs || [];
        var buf = new buffer_list_1.default();
        buf.addInt16(dataTypeIDs.length);
        dataTypeIDs.forEach(function (dataTypeID) {
            buf.addInt32(dataTypeID);
        });
        return buf.join(true, 't');
    },
    dataRow: function (columns) {
        columns = columns || [];
        var buf = new buffer_list_1.default();
        buf.addInt16(columns.length);
        columns.forEach(function (col) {
            if (col == null) {
                buf.addInt32(-1);
            }
            else {
                var strBuf = Buffer.from(col, 'utf8');
                buf.addInt32(strBuf.length);
                buf.add(strBuf);
            }
        });
        return buf.join(true, 'D');
    },
    error: function (fields) {
        return buffers.errorOrNotice(fields).join(true, 'E');
    },
    notice: function (fields) {
        return buffers.errorOrNotice(fields).join(true, 'N');
    },
    errorOrNotice: function (fields) {
        fields = fields || [];
        var buf = new buffer_list_1.default();
        fields.forEach(function (field) {
            buf.addChar(field.type);
            buf.addCString(field.value);
        });
        return buf.add(Buffer.from([0])); // terminator
    },
    parseComplete: function () {
        return new buffer_list_1.default().join(true, '1');
    },
    bindComplete: function () {
        return new buffer_list_1.default().join(true, '2');
    },
    notification: function (id, channel, payload) {
        return new buffer_list_1.default().addInt32(id).addCString(channel).addCString(payload).join(true, 'A');
    },
    emptyQuery: function () {
        return new buffer_list_1.default().join(true, 'I');
    },
    portalSuspended: function () {
        return new buffer_list_1.default().join(true, 's');
    },
    closeComplete: function () {
        return new buffer_list_1.default().join(true, '3');
    },
    copyIn: function (cols) {
        const list = new buffer_list_1.default()
            // text mode
            .addByte(0)
            // column count
            .addInt16(cols);
        for (let i = 0; i < cols; i++) {
            list.addInt16(i);
        }
        return list.join(true, 'G');
    },
    copyOut: function (cols) {
        const list = new buffer_list_1.default()
            // text mode
            .addByte(0)
            // column count
            .addInt16(cols);
        for (let i = 0; i < cols; i++) {
            list.addInt16(i);
        }
        return list.join(true, 'H');
    },
    copyData: function (bytes) {
        return new buffer_list_1.default().add(bytes).join(true, 'd');
    },
    copyDone: function () {
        return new buffer_list_1.default().join(true, 'c');
    }
};
exports.default = buffers;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXHJlcG9zXFxub2RlLXBvc3RncmVzXFxwYWNrYWdlc1xccGctcHJvdG9jb2xcXHNyY1xcdGVzdGluZ1xcdGVzdC1idWZmZXJzLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsd0VBQXdFO0FBQ3hFLGdFQUF1QztBQUV2QyxNQUFNLE9BQU8sR0FBRztJQUNaLGFBQWEsRUFBRTtRQUNYLE9BQU8sSUFBSSxxQkFBVSxFQUFFLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ2xFLENBQUM7SUFFRCxnQkFBZ0IsRUFBRTtRQUNkLE9BQU8sSUFBSSxxQkFBVSxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDeEQsQ0FBQztJQUVELCtCQUErQixFQUFFO1FBQzdCLE9BQU8sSUFBSSxxQkFBVSxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDeEQsQ0FBQztJQUVELHlCQUF5QixFQUFFO1FBQ3ZCLE9BQU8sSUFBSSxxQkFBVSxFQUFFO2FBQ2xCLFFBQVEsQ0FBQyxDQUFDLENBQUM7YUFDWCxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFDOUIsSUFBSSxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztJQUN6QixDQUFDO0lBRUQsa0JBQWtCLEVBQUU7UUFDaEIsT0FBTyxJQUFJLHFCQUFVLEVBQUUsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUMsVUFBVSxDQUFDLGVBQWUsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxD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LElBQUksQ0FBQyxDQUFDO1FBQ3BCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLEVBQUUsQ0FBQyxFQUFFLEVBQUU7WUFDM0IsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUNwQjtRQUNELE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDaEMsQ0FBQztJQUVELE9BQU8sRUFBRSxVQUFVLElBQVk7UUFDM0IsTUFBTSxJQUFJLEdBQUcsSUFBSSxxQkFBVSxFQUFFO1lBQ3pCLFlBQVk7YUFDWCxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ1gsZUFBZTthQUNkLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNwQixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQzNCLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDcEI7UUFDRCxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ2hDLENBQUM7SUFFRCxRQUFRLEVBQUUsVUFBVSxLQUFhO1FBQzdCLE9BQU8sSUFBSSxxQkFBVSxFQUFFLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDdkQsQ0FBQztJQUVELFFBQVEsRUFBRTtRQUNOLE9BQU8sSUFBSSxxQkFBVSxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztJQUM1QyxDQUFDO0NBQ0osQ0FBQztBQUVGLGtCQUFlLE9BQU8sQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxccmVwb3NcXG5vZGUtcG9zdGdyZXNcXHBhY2thZ2VzXFxwZy1wcm90b2NvbFxcc3JjXFx0ZXN0aW5nXFx0ZXN0LWJ1ZmZlcnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gaHR0cHM6Ly93d3cucG9zdGdyZXNxbC5vcmcvZG9jcy9jdXJyZW50L3Byb3RvY29sLW1lc3NhZ2UtZm9ybWF0cy5odG1sXG5pbXBvcnQgQnVmZmVyTGlzdCBmcm9tICcuL2J1ZmZlci1saXN0JztcblxuY29uc3QgYnVmZmVycyA9IHtcbiAgICByZWFkeUZvclF1ZXJ5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBuZXcgQnVmZmVyTGlzdCgpLmFkZChCdWZmZXIuZnJvbSgnSScpKS5qb2luKHRydWUsICdaJyk7XG4gICAgfSxcblxuICAgIGF1dGhlbnRpY2F0aW9uT2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBCdWZmZXJMaXN0KCkuYWRkSW50MzIoMCkuam9pbih0cnVlLCAnUicpO1xuICAgIH0sXG5cbiAgICBhdXRoZW50aWNhdGlvbkNsZWFydGV4dFBhc3N3b3JkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBuZXcgQnVmZmVyTGlzdCgpLmFkZEludDMyKDMpLmpvaW4odHJ1ZSwgJ1InKTtcbiAgICB9LFxuXG4gICAgYXV0aGVudGljYXRpb25NRDVQYXNzd29yZDogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbmV3IEJ1ZmZlckxpc3QoKVxuICAgICAgICAgICAgLmFkZEludDMyKDUpXG4gICAgICAgICAgICAuYWRkKEJ1ZmZlci5mcm9tKFsxLCAyLCAzLCA0XSkpXG4gICAgICAgICAgICAuam9pbih0cnVlLCAnUicpO1xuICAgIH0sXG5cbiAgICBhdXRoZW50aWNhdGlvblNBU0w6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBCdWZmZXJMaXN0KCkuYWRkSW50MzIoMTApLmFkZENTdHJpbmcoJ1NDUkFNLVNIQS0yNTYnKS5hZGRDU3RyaW5nKCcnKS5qb2luKHRydWUsICdSJyk7XG4gICAgfSxcblxuICAgIGF1dGhlbnRpY2F0aW9uU0FTTENvbnRpbnVlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBuZXcgQnVmZmVyTGlzdCgpLmFkZEludDMyKDExKS5hZGRTdHJpbmcoJ2RhdGEnKS5qb2luKHRydWUsICdSJyk7XG4gICAgfSxcblxuICAgIGF1dGhlbnRpY2F0aW9uU0FTTEZpbmFsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBuZXcgQnVmZmVyTGlzdCgpLmFkZEludDMyKDEyKS5hZGRTdHJpbmcoJ2RhdGEnKS5qb2luKHRydWUsICdSJyk7XG4gICAgfSxcblxuICAgIHBhcmFtZXRlclN0YXR1czogZnVuY3Rpb24gKG5hbWU6IHN0cmluZywgdmFsdWU6IHN0cmluZykge1xuICAgICAgICByZXR1cm4gbmV3IEJ1ZmZlckxpc3QoKS5hZGRDU3RyaW5nKG5hbWUpLmFkZENTdHJpbmcodmFsdWUpLmpvaW4odHJ1ZSwgJ1MnKTtcbiAgICB9LFxuXG4gICAgYmFja2VuZEtleURhdGE6IGZ1bmN0aW9uIChwcm9jZXNzSUQ6IG51bWJlciwgc2VjcmV0S2V5OiBudW1iZXIpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBCdWZmZXJMaXN0KCkuYWRkSW50MzIocHJvY2Vzc0lEKS5hZGRJbnQzMihzZWNyZXRLZXkpLmpvaW4odHJ1ZSwgJ0snKTtcbiAgICB9LFxuXG4gICAgY29tbWFuZENvbXBsZXRlOiBmdW5jdGlvbiAoc3RyaW5nOiBzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBCdWZmZXJMaXN0KCkuYWRkQ1N0cmluZyhzdHJpbmcpLmpvaW4odHJ1ZSwgJ0MnKTtcbiAgICB9LFxuXG4gICAgcm93RGVzY3JpcHRpb246IGZ1bmN0aW9uIChmaWVsZHM6IGFueVtdKSB7XG4gICAgICAgIGZpZWxkcyA9IGZpZWxkcyB8fCBbXTtcbiAgICAgICAgdmFyIGJ1ZiA9IG5ldyBCdWZmZXJMaXN0KCk7XG4gICAgICAgIGJ1Zi5hZGRJbnQxNihmaWVsZHMubGVuZ3RoKTtcbiAgICAgICAgZmllbGRzLmZvckVhY2goZnVuY3Rpb24gKGZpZWxkKSB7XG4gICAgICAgICAgICBidWYuYWRkQ1N0cmluZyhmaWVsZC5uYW1lKVxuICAgICAgICAgICAgICAgIC5hZGRJbnQzMihmaWVsZC50YWJsZUlEIHx8IDApXG4gICAgICAgICAgICAgICAgLmFkZEludDE2KGZpZWxkLmF0dHJpYnV0ZU51bWJlciB8fCAwKVxuICAgICAgICAgICAgICAgIC5hZGRJbnQzMihmaWVsZC5kYXRhVHlwZUlEIHx8IDApXG4gICAgICAgICAgICAgICAgLmFkZEludDE2KGZpZWxkLmRhdGFUeXBlU2l6ZSB8fCAwKVxuICAgICAgICAgICAgICAgIC5hZGRJbnQzMihmaWVsZC50eXBlTW9kaWZpZXIgfHwgMClcbiAgICAgICAgICAgICAgICAuYWRkSW50MTYoZmllbGQuZm9ybWF0Q29kZSB8fCAwKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBidWYuam9pbih0cnVlLCAnVCcpO1xuICAgIH0sXG5cbiAgICBwYXJhbWV0ZXJEZXNjcmlwdGlvbjogZnVuY3Rpb24gKGRhdGFUeXBlSURzOiBudW1iZXJbXSkge1xuICAgICAgICBkYXRhVHlwZUlEcyA9IGRhdGFUeXBlSURzIHx8IFtdO1xuICAgICAgICB2YXIgYnVmID0gbmV3IEJ1ZmZlckxpc3QoKTtcbiAgICAgICAgYnVmLmFkZEludDE2KGRhdGFUeXBlSURzLmxlbmd0aCk7XG4gICAgICAgIGRhdGFUeXBlSURzLmZvckVhY2goZnVuY3Rpb24gKGRhdGFUeXBlSUQpIHtcbiAgICAgICAgICAgIGJ1Zi5hZGRJbnQzMihkYXRhVHlwZUlEKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBidWYuam9pbih0cnVlLCAndCcpO1xuICAgIH0sXG5cbiAgICBkYXRhUm93OiBmdW5jdGlvbiAoY29sdW1uczogYW55W10pIHtcbiAgICAgICAgY29sdW1ucyA9IGNvbHVtbnMgfHwgW107XG4gICAgICAgIHZhciBidWYgPSBuZXcgQnVmZmVyTGlzdCgpO1xuICAgICAgICBidWYuYWRkSW50MTYoY29sdW1ucy5sZW5ndGgpO1xuICAgICAgICBjb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKGNvbCkge1xuICAgICAgICAgICAgaWYgKGNvbCA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgYnVmLmFkZEludDMyKC0xKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0ckJ1ZiA9IEJ1ZmZlci5mcm9tKGNvbCwgJ3V0ZjgnKTtcbiAgICAgICAgICAgICAgICBidWYuYWRkSW50MzIoc3RyQnVmLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgYnVmLmFkZChzdHJCdWYpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGJ1Zi5qb2luKHRydWUsICdEJyk7XG4gICAgfSxcblxuICAgIGVycm9yOiBmdW5jdGlvbiAoZmllbGRzOiBhbnkpIHtcbiAgICAgICAgcmV0dXJuIGJ1ZmZlcnMuZXJyb3JPck5vdGljZShmaWVsZHMpLmpvaW4odHJ1ZSwgJ0UnKTtcbiAgICB9LFxuXG4gICAgbm90aWNlOiBmdW5jdGlvbiAoZmllbGRzOiBhbnkpIHtcbiAgICAgICAgcmV0dXJuIGJ1ZmZlcnMuZXJyb3JPck5vdGljZShmaWVsZHMpLmpvaW4odHJ1ZSwgJ04nKTtcbiAgICB9LFxuXG4gICAgZXJyb3JPck5vdGljZTogZnVuY3Rpb24gKGZpZWxkczogYW55KSB7XG4gICAgICAgIGZpZWxkcyA9IGZpZWxkcyB8fCBbXTtcbiAgICAgICAgdmFyIGJ1ZiA9IG5ldyBCdWZmZXJMaXN0KCk7XG4gICAgICAgIGZpZWxkcy5mb3JFYWNoKGZ1bmN0aW9uIChmaWVsZDogYW55KSB7XG4gICAgICAgICAgICBidWYuYWRkQ2hhcihmaWVsZC50eXBlKTtcbiAgICAgICAgICAgIGJ1Zi5hZGRDU3RyaW5nKGZpZWxkLnZhbHVlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBidWYuYWRkKEJ1ZmZlci5mcm9tKFswXSkpOyAvLyB0ZXJtaW5hdG9yXG4gICAgfSxcblxuICAgIHBhcnNlQ29tcGxldGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBCdWZmZXJMaXN0KCkuam9pbih0cnVlLCAnMScpO1xuICAgIH0sXG5cbiAgICBiaW5kQ29tcGxldGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBCdWZmZXJMaXN0KCkuam9pbih0cnVlLCAnMicpO1xuICAgIH0sXG5cbiAgICBub3RpZmljYXRpb246IGZ1bmN0aW9uIChpZDogbnVtYmVyLCBjaGFubmVsOiBzdHJpbmcsIHBheWxvYWQ6IHN0cmluZykge1xuICAgICAgICByZXR1cm4gbmV3IEJ1ZmZlckxpc3QoKS5hZGRJbnQzMihpZCkuYWRkQ1N0cmluZyhjaGFubmVsKS5hZGRDU3RyaW5nKHBheWxvYWQpLmpvaW4odHJ1ZSwgJ0EnKTtcbiAgICB9LFxuXG4gICAgZW1wdHlRdWVyeTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbmV3IEJ1ZmZlckxpc3QoKS5qb2luKHRydWUsICdJJyk7XG4gICAgfSxcblxuICAgIHBvcnRhbFN1c3BlbmRlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gbmV3IEJ1ZmZlckxpc3QoKS5qb2luKHRydWUsICdzJyk7XG4gICAgfSxcblxuICAgIGNsb3NlQ29tcGxldGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBCdWZmZXJMaXN0KCkuam9pbih0cnVlLCAnMycpO1xuICAgIH0sXG5cbiAgICBjb3B5SW46IGZ1bmN0aW9uIChjb2xzOiBudW1iZXIpIHtcbiAgICAgICAgY29uc3QgbGlzdCA9IG5ldyBCdWZmZXJMaXN0KClcbiAgICAgICAgICAgIC8vIHRleHQgbW9kZVxuICAgICAgICAgICAgLmFkZEJ5dGUoMClcbiAgICAgICAgICAgIC8vIGNvbHVtbiBjb3VudFxuICAgICAgICAgICAgLmFkZEludDE2KGNvbHMpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbHM7IGkrKykge1xuICAgICAgICAgICAgbGlzdC5hZGRJbnQxNihpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbGlzdC5qb2luKHRydWUsICdHJyk7XG4gICAgfSxcblxuICAgIGNvcHlPdXQ6IGZ1bmN0aW9uIChjb2xzOiBudW1iZXIpIHtcbiAgICAgICAgY29uc3QgbGlzdCA9IG5ldyBCdWZmZXJMaXN0KClcbiAgICAgICAgICAgIC8vIHRleHQgbW9kZVxuICAgICAgICAgICAgLmFkZEJ5dGUoMClcbiAgICAgICAgICAgIC8vIGNvbHVtbiBjb3VudFxuICAgICAgICAgICAgLmFkZEludDE2KGNvbHMpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbHM7IGkrKykge1xuICAgICAgICAgICAgbGlzdC5hZGRJbnQxNihpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbGlzdC5qb2luKHRydWUsICdIJyk7XG4gICAgfSxcblxuICAgIGNvcHlEYXRhOiBmdW5jdGlvbiAoYnl0ZXM6IEJ1ZmZlcikge1xuICAgICAgICByZXR1cm4gbmV3IEJ1ZmZlckxpc3QoKS5hZGQoYnl0ZXMpLmpvaW4odHJ1ZSwgJ2QnKTtcbiAgICB9LFxuXG4gICAgY29weURvbmU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBCdWZmZXJMaXN0KCkuam9pbih0cnVlLCAnYycpO1xuICAgIH1cbn07XG5cbmV4cG9ydCBkZWZhdWx0IGJ1ZmZlcnM7XG4iXSwidmVyc2lvbiI6M30=